var wysihtml5={version:"0.3.0_rc2",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window.rangy=function(){function S(e,d){var f=typeof e[d];return f==J||!!(f==N&&e[d])||"unknown"==f}function R(d,c){return !!(typeof d[c]==N&&d[c])}function T(d,c){return typeof d[c]!=K}function Q(b){return function(a,f){for(var e=f.length;e--;){if(!b(a,f[e])){return !1}}return !0}}function P(b){return b&&I(b,C)&&u(b,F)}function O(b){window.alert("Rangy not supported in your browser. Reason: "+b);G.initialized=!0;G.supported=!1}function M(){if(!G.initialized){var b,f=!1,e=!1;S(document,"createRange")&&(b=document.createRange(),I(b,H)&&u(b,D)&&(f=!0),b.detach());if((b=R(document,"body")?document.body:document.getElementsByTagName("body")[0])&&S(b,"createTextRange")){b=b.createTextRange(),P(b)&&(e=!0)}!f&&!e&&O("Neither Range nor TextRange are implemented");G.initialized=!0;G.features={implementsDomRange:f,implementsTextRange:e};f=v.concat(l);e=0;for(b=f.length;e<b;++e){try{f[e](G)}catch(c){R(window,"console")&&S(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",c)}}}}function L(b){this.name=b;this.supported=this.initialized=!1}var N="object",J="function",K="undefined",D="startContainer,startOffset,endContainer,endOffset,collapsed,commonAncestorContainer,START_TO_START,START_TO_END,END_TO_START,END_TO_END".split(","),H="setStart,setStartBefore,setStartAfter,setEnd,setEndBefore,setEndAfter,collapse,selectNode,selectNodeContents,compareBoundaryPoints,deleteContents,extractContents,cloneContents,insertNode,surroundContents,cloneRange,toString,detach".split(","),F="boundingHeight,boundingLeft,boundingTop,boundingWidth,htmlText,text".split(","),C="collapse,compareEndPoints,duplicate,getBookmark,moveToBookmark,moveToElementText,parentElement,pasteHTML,select,setEndPoint,getBoundingClientRect".split(","),I=Q(S),B=Q(R),u=Q(T),G={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:S,isHostObject:R,isHostProperty:T,areHostMethods:I,areHostObjects:B,areHostProperties:u,isTextRange:P},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};G.fail=O;G.warn=function(b){b="Rangy warning: "+b;G.config.alertOnWarn?window.alert(b):typeof window.console!=K&&typeof window.console.log!=K&&window.console.log(b)};({}).hasOwnProperty?G.util.extend=function(e,d){for(var f in d){d.hasOwnProperty(f)&&(e[f]=d[f])}}:O("hasOwnProperty not supported");var l=[],v=[];G.init=M;G.addInitListener=function(b){G.initialized?b(G):l.push(b)};var t=[];G.addCreateMissingNativeApiListener=function(b){t.push(b)};G.createMissingNativeApi=function(e){e=e||window;M();for(var d=0,f=t.length;d<f;++d){t[d](e)}};L.prototype.fail=function(b){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+b)};L.prototype.warn=function(b){G.warn("Module "+this.name+": "+b)};L.prototype.createError=function(b){return Error("Error in Rangy "+this.name+" module: "+b)};G.createModule=function(e,d){var f=new L(e);G.modules[e]=f;v.push(function(b){d(b,f);f.initialized=!0;f.supported=!0})};G.requireModules=function(f){for(var e=0,j=f.length,i,h;e<j;++e){h=f[e];i=G.modules[h];if(!i||!(i instanceof L)){throw Error("Module '"+h+"' not found")}if(!i.supported){throw Error("Module '"+h+"' not supported")}}};var E=!1,B=function(){E||(E=!0,G.initialized||M())};if(typeof window==K){O("No window found")}else{if(typeof document==K){O("No document found")}else{return S(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",B,!1),S(window,"addEventListener")?window.addEventListener("load",B,!1):S(window,"attachEvent")?window.attachEvent("onload",B):O("Window does not have required addEventListener or attachEvent method"),G}}}();rangy.createModule("DomUtil",function(E,D){function F(d){for(var c=0;d=d.previousSibling;){c++}return c}function C(f,e){var h=[],g;for(g=f;g;g=g.parentNode){h.push(g)}for(g=e;g;g=g.parentNode){if(u(h,g)){return g}}return null}function B(e,d,f){for(f=f?e:e.parentNode;f;){e=f.parentNode;if(e===d){return f}f=e}return null}function A(b){b=b.nodeType;return 3==b||4==b||8==b}function y(f,e){var h=e.nextSibling,g=e.parentNode;h?g.insertBefore(f,h):g.appendChild(f);return f}function x(b){if(9==b.nodeType){return b}if(typeof b.ownerDocument!=t){return b.ownerDocument}if(typeof b.document!=t){return b.document}if(b.parentNode){return x(b.parentNode)}throw Error("getDocument: no document found for node")}function z(b){return !b?"[No node]":A(b)?'"'+b.data+'"':1==b.nodeType?"<"+b.nodeName+(b.id?' id="'+b.id+'"':"")+">["+b.childNodes.length+"]":b.nodeName}function v(b){this._next=this.root=b}function w(d,c){this.node=d;this.offset=c}function o(b){this.code=this[b];this.codeName=b;this.message="DOMException: "+this.codeName}var t="undefined",s=E.util;s.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||D.fail("document missing a Node creation method");s.isHostMethod(document,"getElementsByTagName")||D.fail("document missing getElementsByTagName method");var l=document.createElement("div");s.areHostMethods(l,["insertBefore","appendChild","cloneNode"])||D.fail("Incomplete Element implementation");s.isHostProperty(l,"innerHTML")||D.fail("Element is missing innerHTML property");l=document.createTextNode("test");s.areHostMethods(l,["splitText","deleteData","insertData","appendData","cloneNode"])||D.fail("Incomplete Text Node implementation");var u=function(e,d){for(var f=e.length;f--;){if(e[f]===d){return !0}}return !1};v.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var d=this._current=this._next,c;if(this._current){c=d.firstChild;if(!c){for(c=null;d!==this.root&&!(c=d.nextSibling);){d=d.parentNode}}this._next=c}return this._current},detach:function(){this._current=this._next=this.root=null}};w.prototype={equals:function(b){return this.node===b.node&this.offset==b.offset},inspect:function(){return"[DomPosition("+z(this.node)+":"+this.offset+")]"}};o.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};o.prototype.toString=function(){return this.message};E.dom={arrayContains:u,isHtmlNamespace:function(d){var c;return typeof d.namespaceURI==t||null===(c=d.namespaceURI)||"http://www.w3.org/1999/xhtml"==c},parentElement:function(b){b=b.parentNode;return 1==b.nodeType?b:null},getNodeIndex:F,getNodeLength:function(d){var c;return A(d)?d.length:(c=d.childNodes)?c.length:0},getCommonAncestor:C,isAncestorOf:function(e,d,f){for(d=f?d:d.parentNode;d;){if(d===e){return !0}d=d.parentNode}return !1},getClosestAncestorIn:B,isCharacterDataNode:A,insertAfter:y,splitDataNode:function(e,d){var f=e.cloneNode(!1);f.deleteData(0,d);e.deleteData(d,e.length-d);y(f,e);return f},getDocument:x,getWindow:function(b){b=x(b);if(typeof b.defaultView!=t){return b.defaultView}if(typeof b.parentWindow!=t){return b.parentWindow}throw Error("Cannot get a window object for node")},getIframeWindow:function(b){if(typeof b.contentWindow!=t){return b.contentWindow}if(typeof b.contentDocument!=t){return b.contentDocument.defaultView}throw Error("getIframeWindow: No Window object found for iframe element")},getIframeDocument:function(b){if(typeof b.contentDocument!=t){return b.contentDocument}if(typeof b.contentWindow!=t){return b.contentWindow.document}throw Error("getIframeWindow: No Document object found for iframe element")},getBody:function(b){return s.isHostObject(b,"body")?b.body:b.getElementsByTagName("body")[0]},getRootContainer:function(d){for(var c;c=d.parentNode;){d=c}return d},comparePoints:function(a,h,f,e){var d;if(a==f){return h===e?0:h<e?-1:1}if(d=B(f,a,!0)){return h<=F(d)?-1:1}if(d=B(a,f,!0)){return F(d)<e?-1:1}h=C(a,f);a=a===h?h:B(a,h,!0);f=f===h?h:B(f,h,!0);if(a===f){throw Error("comparePoints got to case 4 and childA and childB are the same!")}for(h=h.firstChild;h;){if(h===a){return -1}if(h===f){return 1}h=h.nextSibling}throw Error("Should not be here!")},inspectNode:z,fragmentFromNodeChildren:function(e){for(var d=x(e).createDocumentFragment(),f;f=e.firstChild;){d.appendChild(f)}return d},createIterator:function(b){return new v(b)},DomPosition:w};E.DOMException=o});rangy.createModule("DomRange",function(a3){function a2(d,c){return 3!=d.nodeType&&(aT.isAncestorOf(d,c.startContainer,!0)||aT.isAncestorOf(d,c.endContainer,!0))}function a4(b){return aT.getDocument(b.startContainer)}function a1(f,e,j){if(e=f._listeners[e]){for(var i=0,h=e.length;i<h;++i){e[i].call(f,{target:f,args:j})}}}function a0(b){return new aK(b.parentNode,aT.getNodeIndex(b))}function aZ(b){return new aK(b.parentNode,aT.getNodeIndex(b)+1)}function aX(f,e,h){var g=11==f.nodeType?f.firstChild:f;aT.isCharacterDataNode(e)?h==e.length?aT.insertAfter(f,e):e.parentNode.insertBefore(f,0==h?e:aT.splitDataNode(e,h)):h>=e.childNodes.length?e.appendChild(f):e.insertBefore(f,e.childNodes[h]);return g}function aW(a){for(var h,f,e=a4(a.range).createDocumentFragment();f=a.next();){h=a.isPartiallySelectedSubtree();f=f.cloneNode(!h);h&&(h=a.getSubtreeIterator(),f.appendChild(aW(h)),h.detach(!0));if(10==f.nodeType){throw new aA("HIERARCHY_REQUEST_ERR")}e.appendChild(f)}return e}function aY(g,f,j){for(var i,h,j=j||{stop:!1};i=g.next();){if(g.isPartiallySelectedSubtree()){if(!1===f(i)){j.stop=!0;break}else{if(i=g.getSubtreeIterator(),aY(i,f,j),i.detach(!0),j.stop){break}}}else{for(i=aT.createIterator(i);h=i.next();){if(!1===f(h)){j.stop=!0;return}}}}}function aU(d){for(var c;d.next();){d.isPartiallySelectedSubtree()?(c=d.getSubtreeIterator(),aU(c),c.detach(!0)):d.remove()}}function aV(a){for(var h,f=a4(a.range).createDocumentFragment(),e;h=a.next();){a.isPartiallySelectedSubtree()?(h=h.cloneNode(!1),e=a.getSubtreeIterator(),h.appendChild(aV(e)),e.detach(!0)):a.remove();if(10==h.nodeType){throw new aA("HIERARCHY_REQUEST_ERR")}f.appendChild(h)}return f}function aO(g,f,n){var m=!(!f||!f.length),l,i=!!n;m&&(l=RegExp("^("+f.join("|")+")$"));var h=[];aY(new aP(g,!1),function(b){(!m||l.test(b.nodeType))&&(!i||n(b))&&h.push(b)});return h}function aR(b){return"["+("undefined"==typeof b.getName?"Range":b.getName())+"("+aT.inspectNode(b.startContainer)+":"+b.startOffset+", "+aT.inspectNode(b.endContainer)+":"+b.endOffset+")]"}function aP(e,d){this.range=e;this.clonePartiallySelectedTextNodes=d;if(!e.collapsed){this.sc=e.startContainer;this.so=e.startOffset;this.ec=e.endContainer;this.eo=e.endOffset;var f=e.commonAncestorContainer;this.sc===this.ec&&aT.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===f&&!aT.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:aT.getClosestAncestorIn(this.sc,f,!0),this._last=this.ec===f&&!aT.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:aT.getClosestAncestorIn(this.ec,f,!0))}}function aN(b){this.code=this[b];this.codeName=b;this.message="RangeException: "+this.codeName}function aS(e,d,f){this.nodes=aO(e,d,f);this._next=this.nodes[0];this._position=0}function aM(b){return function(a,h){for(var f,e=h?a:a.parentNode;e;){f=e.nodeType;if(aT.arrayContains(b,f)){return e}e=e.parentNode}return null}}function aH(d,c){if(aD(d,c)){throw new aN("INVALID_NODE_TYPE_ERR")}}function aQ(b){if(!b.startContainer){throw new aA("INVALID_STATE_ERR")}}function aF(d,c){if(!aT.arrayContains(c,d.nodeType)){throw new aN("INVALID_NODE_TYPE_ERR")}}function aI(d,c){if(0>c||c>(aT.isCharacterDataNode(d)?d.length:d.childNodes.length)){throw new aA("INDEX_SIZE_ERR")}}function aG(d,c){if(am(d,!0)!==am(c,!0)){throw new aA("WRONG_DOCUMENT_ERR")}}function aB(b){if(aC(b,!0)){throw new aA("NO_MODIFICATION_ALLOWED_ERR")}}function aL(d,c){if(!d){throw new aA(c)}}function aJ(b){aQ(b);if(!aT.arrayContains(av,b.startContainer.nodeType)&&!am(b.startContainer,!0)||!aT.arrayContains(av,b.endContainer.nodeType)&&!am(b.endContainer,!0)||!(b.startOffset<=(aT.isCharacterDataNode(b.startContainer)?b.startContainer.length:b.startContainer.childNodes.length))||!(b.endOffset<=(aT.isCharacterDataNode(b.endContainer)?b.endContainer.length:b.endContainer.childNodes.length))){throw Error("Range error: Range is no longer valid after DOM mutation ("+b.inspect()+")")}}function ay(){}function aq(b){b.START_TO_START=ak;b.START_TO_END=ag;b.END_TO_END=a5;b.END_TO_START=af;b.NODE_BEFORE=ae;b.NODE_AFTER=ad;b.NODE_BEFORE_AND_AFTER=ac;b.NODE_INSIDE=aj}function aw(b){aq(b);aq(b.prototype)}function ax(d,c){return function(){aJ(this);var g=this.startContainer,f=this.startOffset,b=this.commonAncestorContainer,a=new aP(this,!0);g!==b&&(g=aT.getClosestAncestorIn(g,b,!0),f=aZ(g),g=f.node,f=f.offset);aY(a,aB);a.reset();b=d(a);a.detach();c(this,g,f,g,f);return b}}function at(b,j,f){function e(g,d){return function(a){aQ(this);aF(a,ap);aF(ao(a),av);a=(g?a0:aZ)(a);(d?c:k)(this,a.node,a.offset)}}function c(h,d,m){var i=h.endContainer,l=h.endOffset;if(d!==h.startContainer||m!==h.startOffset){if(ao(d)!=ao(i)||1==aT.comparePoints(d,m,i,l)){i=d,l=m}j(h,d,m,i,l)}}function k(h,d,m){var i=h.startContainer,l=h.startOffset;if(d!==h.endContainer||m!==h.endOffset){if(ao(d)!=ao(i)||-1==aT.comparePoints(d,m,i,l)){i=d,l=m}j(h,i,l,d,m)}}b.prototype=new ay;a3.util.extend(b.prototype,{setStart:function(g,d){aQ(this);aH(g,!0);aI(g,d);c(this,g,d)},setEnd:function(g,d){aQ(this);aH(g,!0);aI(g,d);k(this,g,d)},setStartBefore:e(!0,!0),setStartAfter:e(!1,!0),setEndBefore:e(!0,!1),setEndAfter:e(!1,!1),collapse:function(d){aJ(this);d?j(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):j(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(d){aQ(this);aH(d,!0);j(this,d,0,d,aT.getNodeLength(d))},selectNode:function(g){aQ(this);aH(g,!1);aF(g,ap);var d=a0(g),g=aZ(g);j(this,d.node,d.offset,g.node,g.offset)},extractContents:ax(aV,j),deleteContents:ax(aU,j),canSurroundContents:function(){aJ(this);aB(this.startContainer);aB(this.endContainer);var g=new aP(this,!0),d=g._first&&a2(g._first,this)||g._last&&a2(g._last,this);g.detach();return !d},detach:function(){f(this)},splitBoundaries:function(){aJ(this);var h=this.startContainer,d=this.startOffset,m=this.endContainer,i=this.endOffset,l=h===m;aT.isCharacterDataNode(m)&&0<i&&i<m.length&&aT.splitDataNode(m,i);aT.isCharacterDataNode(h)&&0<d&&d<h.length&&(h=aT.splitDataNode(h,d),l?(i-=d,m=h):m==h.parentNode&&i>=aT.getNodeIndex(h)&&i++,d=0);j(this,h,d,m,i)},normalizeBoundaries:function(){aJ(this);var h=this.startContainer,d=this.startOffset,o=this.endContainer,m=this.endOffset,n=function(p){var g=p.nextSibling;g&&g.nodeType==p.nodeType&&(o=p,m=p.length,p.appendData(g.data),g.parentNode.removeChild(g))},l=function(p){var g=p.previousSibling;if(g&&g.nodeType==p.nodeType){h=p;var a=p.length;d=g.length;p.insertData(0,g.data);g.parentNode.removeChild(g);h==o?(m+=d,o=h):o==p.parentNode&&(g=aT.getNodeIndex(p),m==g?(o=p,m=a):m>g&&m--)}},i=!0;aT.isCharacterDataNode(o)?o.length==m&&n(o):(0<m&&(i=o.childNodes[m-1])&&aT.isCharacterDataNode(i)&&n(i),i=!this.collapsed);i?aT.isCharacterDataNode(h)?0==d&&l(h):d<h.childNodes.length&&(n=h.childNodes[d])&&aT.isCharacterDataNode(n)&&l(n):(h=o,d=m);j(this,h,d,o,m)},collapseToPoint:function(g,d){aQ(this);aH(g,!0);aI(g,d);(g!==this.startContainer||d!==this.startOffset||g!==this.endContainer||d!==this.endOffset)&&j(this,g,d,g,d)}});aw(b)}function an(b){b.collapsed=b.startContainer===b.endContainer&&b.startOffset===b.endOffset;b.commonAncestorContainer=b.collapsed?b.startContainer:aT.getCommonAncestor(b.startContainer,b.endContainer)}function ar(f,d,n,l,m){var i=f.startContainer!==d||f.startOffset!==n,h=f.endContainer!==l||f.endOffset!==m;f.startContainer=d;f.startOffset=n;f.endContainer=l;f.endOffset=m;an(f);a1(f,"boundarychange",{startMoved:i,endMoved:h})}function az(b){this.startContainer=b;this.startOffset=0;this.endContainer=b;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};an(this)}a3.requireModules(["DomUtil"]);var aT=a3.dom,aK=aT.DomPosition,aA=a3.DOMException;aP.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var b=this._current=this._next;b&&(this._next=b!==this._last?b.nextSibling:null,aT.isCharacterDataNode(b)&&this.clonePartiallySelectedTextNodes&&(b===this.ec&&(b=b.cloneNode(!0)).deleteData(this.eo,b.length-this.eo),this._current===this.sc&&(b=b.cloneNode(!0)).deleteData(0,this.so)));return b},remove:function(){var e=this._current,d,f;aT.isCharacterDataNode(e)&&(e===this.sc||e===this.ec)?(d=e===this.sc?this.so:0,f=e===this.ec?this.eo:e.length,d!=f&&e.deleteData(d,f-d)):e.parentNode&&e.parentNode.removeChild(e)},isPartiallySelectedSubtree:function(){return a2(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode){a=this.range.cloneRange(),a.collapse()}else{a=new az(a4(this.range));var l=this._current,k=l,h=0,i=l,f=aT.getNodeLength(l);aT.isAncestorOf(l,this.sc,!0)&&(k=this.sc,h=this.so);aT.isAncestorOf(l,this.ec,!0)&&(i=this.ec,f=this.eo);ar(a,k,h,i,f)}return new aP(a,this.clonePartiallySelectedTextNodes)},detach:function(b){b&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};aN.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};aN.prototype.toString=function(){return this.message};aS.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var ap=[1,3,4,5,7,8,10],av=[2,9,11],al=[1,3,4,5,7,8,10,11],au=[1,3,4,5,7,8],ao=aT.getRootContainer,am=aM([9,11]),aC=aM([5,6,10,12]),aD=aM([6,10,12]),ab=document.createElement("style"),ai=!1;try{ab.innerHTML="<b>x</b>",ai=3==ab.firstChild.nodeType}catch(aE){}a3.features.htmlParsingConforms=ai;var ah="startContainer,startOffset,endContainer,endOffset,collapsed,commonAncestorContainer".split(","),ak=0,ag=1,a5=2,af=3,ae=0,ad=1,ac=2,aj=3;ay.prototype={attachListener:function(d,c){this._listeners[d].push(c)},compareBoundaryPoints:function(f,e){aJ(this);aG(this.startContainer,e.startContainer);var h=f==af||f==ak?"start":"end",g=f==ag||f==ak?"start":"end";return aT.comparePoints(this[h+"Container"],this[h+"Offset"],e[g+"Container"],e[g+"Offset"])},insertNode:function(b){aJ(this);aF(b,al);aB(this.startContainer);if(aT.isAncestorOf(b,this.startContainer,!0)){throw new aA("HIERARCHY_REQUEST_ERR")}this.setStartBefore(aX(b,this.startContainer,this.startOffset))},cloneContents:function(){aJ(this);var a,d;if(this.collapsed){return a4(this).createDocumentFragment()}if(this.startContainer===this.endContainer&&aT.isCharacterDataNode(this.startContainer)){return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),d=a4(this).createDocumentFragment(),d.appendChild(a),d}d=new aP(this,!0);a=aW(d);d.detach();return a},canSurroundContents:function(){aJ(this);aB(this.startContainer);aB(this.endContainer);var d=new aP(this,!0),c=d._first&&a2(d._first,this)||d._last&&a2(d._last,this);d.detach();return !c},surroundContents:function(d){aF(d,au);if(!this.canSurroundContents()){throw new aN("BAD_BOUNDARYPOINTS_ERR")}var c=this.extractContents();if(d.hasChildNodes()){for(;d.lastChild;){d.removeChild(d.lastChild)}}aX(d,this.startContainer,this.startOffset);d.appendChild(c);this.selectNode(d)},cloneRange:function(){aJ(this);for(var a=new az(a4(this)),f=ah.length,e;f--;){e=ah[f],a[e]=this[e]}return a},toString:function(){aJ(this);var d=this.startContainer;if(d===this.endContainer&&aT.isCharacterDataNode(d)){return 3==d.nodeType||4==d.nodeType?d.data.slice(this.startOffset,this.endOffset):""}var c=[],d=new aP(this,!0);aY(d,function(b){(3==b.nodeType||4==b.nodeType)&&c.push(b.data)});d.detach();return c.join("")},compareNode:function(e){aJ(this);var d=e.parentNode,f=aT.getNodeIndex(e);if(!d){throw new aA("NOT_FOUND_ERR")}e=this.comparePoint(d,f);d=this.comparePoint(d,f+1);return 0>e?0<d?ac:ae:0<d?ad:aj},comparePoint:function(d,c){aJ(this);aL(d,"HIERARCHY_REQUEST_ERR");aG(d,this.startContainer);return 0>aT.comparePoints(d,c,this.startContainer,this.startOffset)?-1:0<aT.comparePoints(d,c,this.endContainer,this.endOffset)?1:0},createContextualFragment:ai?function(f){var e=this.startContainer,h=aT.getDocument(e);if(!e){throw new aA("INVALID_STATE_ERR")}var g=null;1==e.nodeType?g=e:aT.isCharacterDataNode(e)&&(g=aT.parentElement(e));g=null===g||"HTML"==g.nodeName&&aT.isHtmlNamespace(aT.getDocument(g).documentElement)&&aT.isHtmlNamespace(g)?h.createElement("body"):g.cloneNode(!1);g.innerHTML=f;return aT.fragmentFromNodeChildren(g)}:function(a){aQ(this);var d=a4(this).createElement("body");d.innerHTML=a;return aT.fragmentFromNodeChildren(d)},toHtml:function(){aJ(this);var a=a4(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,j){aJ(this);aL(a,"NOT_FOUND_ERR");if(aT.getDocument(a)!==a4(this)){return !1}var i=a.parentNode,f=aT.getNodeIndex(a);aL(i,"NOT_FOUND_ERR");var h=aT.comparePoints(i,f,this.endContainer,this.endOffset),i=aT.comparePoints(i,f+1,this.startContainer,this.startOffset);return j?0>=h&&0<=i:0>h&&0<i},isPointInRange:function(d,c){aJ(this);aL(d,"HIERARCHY_REQUEST_ERR");aG(d,this.startContainer);return 0<=aT.comparePoints(d,c,this.startContainer,this.startOffset)&&0>=aT.comparePoints(d,c,this.endContainer,this.endOffset)},intersectsRange:function(a,h){aJ(this);if(a4(a)!=a4(this)){throw new aA("WRONG_DOCUMENT_ERR")}var f=aT.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),e=aT.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return h?0>=f&&0<=e:0>f&&0<e},intersection:function(f){if(this.intersectsRange(f)){var e=aT.comparePoints(this.startContainer,this.startOffset,f.startContainer,f.startOffset),h=aT.comparePoints(this.endContainer,this.endOffset,f.endContainer,f.endOffset),g=this.cloneRange();-1==e&&g.setStart(f.startContainer,f.startOffset);1==h&&g.setEnd(f.endContainer,f.endOffset);return g}return null},union:function(d){if(this.intersectsRange(d,!0)){var c=this.cloneRange();-1==aT.comparePoints(d.startContainer,d.startOffset,this.startContainer,this.startOffset)&&c.setStart(d.startContainer,d.startOffset);1==aT.comparePoints(d.endContainer,d.endOffset,this.endContainer,this.endOffset)&&c.setEnd(d.endContainer,d.endOffset);return c}throw new aN("Ranges do not intersect")},containsNode:function(d,c){return c?this.intersectsNode(d,!1):this.compareNode(d)==aj},containsNodeContents:function(b){return 0<=this.comparePoint(b,0)&&0>=this.comparePoint(b,aT.getNodeLength(b))},containsRange:function(b){return this.intersection(b).equals(b)},containsNodeText:function(e){var d=this.cloneRange();d.selectNode(e);var f=d.getNodes([3]);return 0<f.length?(d.setStart(f[0],0),e=f.pop(),d.setEnd(e,e.length),e=this.containsRange(d),d.detach(),e):this.containsNodeContents(e)},createNodeIterator:function(d,c){aJ(this);return new aS(this,d,c)},getNodes:function(d,c){aJ(this);return aO(this,d,c)},getDocument:function(){return a4(this)},collapseBefore:function(b){aQ(this);this.setEndBefore(b);this.collapse(!1)},collapseAfter:function(b){aQ(this);this.setStartAfter(b);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(b){return az.rangesEqual(this,b)},inspect:function(){return aR(this)}};at(az,ar,function(b){aQ(b);b.startContainer=b.startOffset=b.endContainer=b.endOffset=null;b.collapsed=b.commonAncestorContainer=null;a1(b,"detach",null);b._listeners=null});a3.rangePrototype=ay.prototype;az.rangeProperties=ah;az.RangeIterator=aP;az.copyComparisonConstants=aw;az.createPrototypeRange=at;az.inspect=aR;az.getRangeDocument=a4;az.rangesEqual=function(d,c){return d.startContainer===c.startContainer&&d.startOffset===c.startOffset&&d.endContainer===c.endContainer&&d.endOffset===c.endOffset};a3.DomRange=az;a3.RangeException=aN});rangy.createModule("WrappedRange",function(g){function p(q,f,w,v){var t=q.duplicate();t.collapse(w);var s=t.parentElement();n.isAncestorOf(f,s,!0)||(s=f);if(!s.canHaveHTML){return new m(s.parentNode,n.getNodeIndex(s))}var f=n.getDocument(s).createElement("span"),u,e=w?"StartToStart":"StartToEnd";do{s.insertBefore(f,f.previousSibling),t.moveToElementText(f)}while(0<(u=t.compareEndPoints(e,q))&&f.previousSibling);e=f.nextSibling;if(-1==u&&e&&n.isCharacterDataNode(e)){t.setEndPoint(w?"EndToStart":"EndToEnd",q);if(/[\r\n]/.test(e.data)){s=t.duplicate();w=s.text.replace(/\r\n/g,"\r").length;for(w=s.moveStart("character",w);-1==s.compareEndPoints("StartToEnd",s);){w++,s.moveStart("character",1)}}else{w=t.text.length}s=new m(e,w)}else{e=(v||!w)&&f.previousSibling,s=(w=(v||w)&&f.nextSibling)&&n.isCharacterDataNode(w)?new m(w,0):e&&n.isCharacterDataNode(e)?new m(e,e.length):new m(s,n.getNodeIndex(f))}f.parentNode.removeChild(f);return s}function j(r,q){var w,v,u=r.offset,t=n.getDocument(r.node),s=t.body.createTextRange(),e=n.isCharacterDataNode(r.node);e?(w=r.node,v=w.parentNode):(w=r.node.childNodes,w=u<w.length?w[u]:null,v=r.node);t=t.createElement("span");t.innerHTML="&#feff;";w?v.insertBefore(t,w):v.appendChild(t);s.moveToElementText(t);s.collapse(!q);v.removeChild(t);if(e){s[q?"moveStart":"moveEnd"]("character",u)}return s}g.requireModules(["DomUtil","DomRange"]);var o,n=g.dom,m=n.DomPosition,l=g.DomRange;if(g.features.implementsDomRange&&(!g.features.implementsTextRange||!g.config.preferTextRange)){(function(){function b(a){for(var i=d.length,f;i--;){f=d[i],a[f]=a.nativeRange[f]}}var t,d=l.rangeProperties,q;o=function(a){if(!a){throw Error("Range must be specified")}this.nativeRange=a;b(this)};l.createPrototypeRange(o,function(i,f,w,v,r){var u=i.endContainer!==v||i.endOffset!=r;if(i.startContainer!==f||i.startOffset!=w||u){i.setEnd(v,r),i.setStart(f,w)}},function(i){i.nativeRange.detach();i.detached=!0;for(var f=d.length,r;f--;){r=d[f],i[r]=null}});t=o.prototype;t.selectNode=function(a){this.nativeRange.selectNode(a);b(this)};t.deleteContents=function(){this.nativeRange.deleteContents();b(this)};t.extractContents=function(){var a=this.nativeRange.extractContents();b(this);return a};t.cloneContents=function(){return this.nativeRange.cloneContents()};t.surroundContents=function(a){this.nativeRange.surroundContents(a);b(this)};t.collapse=function(a){this.nativeRange.collapse(a);b(this)};t.cloneRange=function(){return new o(this.nativeRange.cloneRange())};t.refresh=function(){b(this)};t.toString=function(){return this.nativeRange.toString()};var e=document.createTextNode("test");n.getBody(document).appendChild(e);var s=document.createRange();s.setStart(e,0);s.setEnd(e,0);try{s.setStart(e,1),t.setStart=function(a,f){this.nativeRange.setStart(a,f);b(this)},t.setEnd=function(a,f){this.nativeRange.setEnd(a,f);b(this)},q=function(a){return function(f){this.nativeRange[a](f);b(this)}}}catch(h){t.setStart=function(a,i){try{this.nativeRange.setStart(a,i)}catch(f){this.nativeRange.setEnd(a,i),this.nativeRange.setStart(a,i)}b(this)},t.setEnd=function(a,i){try{this.nativeRange.setEnd(a,i)}catch(f){this.nativeRange.setStart(a,i),this.nativeRange.setEnd(a,i)}b(this)},q=function(a,f){return function(i){try{this.nativeRange[a](i)}catch(c){this.nativeRange[f](i),this.nativeRange[a](i)}b(this)}}}t.setStartBefore=q("setStartBefore","setEndBefore");t.setStartAfter=q("setStartAfter","setEndAfter");t.setEndBefore=q("setEndBefore","setStartBefore");t.setEndAfter=q("setEndAfter","setStartAfter");s.selectNodeContents(e);t.selectNodeContents=s.startContainer==e&&s.endContainer==e&&0==s.startOffset&&s.endOffset==e.length?function(a){this.nativeRange.selectNodeContents(a);b(this)}:function(c){this.setStart(c,0);this.setEnd(c,l.getEndOffset(c))};s.selectNodeContents(e);s.setEnd(e,3);q=document.createRange();q.selectNodeContents(e);q.setEnd(e,4);q.setStart(e,2);t.compareBoundaryPoints=-1==s.compareBoundaryPoints(s.START_TO_END,q)&1==s.compareBoundaryPoints(s.END_TO_START,q)?function(f,c){c=c.nativeRange||c;f==c.START_TO_END?f=c.END_TO_START:f==c.END_TO_START&&(f=c.START_TO_END);return this.nativeRange.compareBoundaryPoints(f,c)}:function(f,c){return this.nativeRange.compareBoundaryPoints(f,c.nativeRange||c)};g.util.isHostMethod(s,"createContextualFragment")&&(t.createContextualFragment=function(c){return this.nativeRange.createContextualFragment(c)});n.getBody(document).removeChild(e);s.detach();q.detach()})(),g.createNativeRange=function(b){return(b||document).createRange()}}else{if(g.features.implementsTextRange){o=function(b){this.textRange=b;this.refresh()};o.prototype=new l(document);o.prototype.refresh=function(){var e,c,i=this.textRange;e=i.parentElement();var h=i.duplicate();h.collapse(!0);c=h.parentElement();h=i.duplicate();h.collapse(!1);i=h.parentElement();c=c==i?c:n.getCommonAncestor(c,i);c=c==e?c:n.getCommonAncestor(e,c);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?c=e=p(this.textRange,c,!0,!0):(e=p(this.textRange,c,!0,!1),c=p(this.textRange,c,!1,!1));this.setStart(e.node,e.offset);this.setEnd(c.node,c.offset)};l.copyComparisonConstants(o);var k=function(){return this}();"undefined"==typeof k.Range&&(k.Range=o);g.createNativeRange=function(b){return(b||document).body.createTextRange()}}}g.features.implementsTextRange&&(o.rangeToTextRange=function(a){if(a.collapsed){return j(new m(a.startContainer,a.startOffset),!0)}var f=j(new m(a.startContainer,a.startOffset),!0),e=j(new m(a.endContainer,a.endOffset),!1),a=n.getDocument(a.startContainer).body.createTextRange();a.setEndPoint("StartToStart",f);a.setEndPoint("EndToEnd",e);return a});o.prototype.getName=function(){return"WrappedRange"};g.WrappedRange=o;g.createRange=function(b){return new o(g.createNativeRange(b||document))};g.createRangyRange=function(b){return new l(b||document)};g.createIframeRange=function(b){return g.createRange(n.getIframeDocument(b))};g.createIframeRangyRange=function(b){return g.createRangyRange(n.getIframeDocument(b))};g.addCreateMissingNativeApiListener(function(b){b=b.document;if(typeof b.createRange=="undefined"){b.createRange=function(){return g.createRange(this)}}b=b=null})});rangy.createModule("WrappedSelection",function(aB,aA){function aC(b){return(b||window).getSelection()}function az(b){return(b||window).document.selection}function ay(f,e,h){var g=h?"end":"start",h=h?"start":"end";f.anchorNode=e[g+"Container"];f.anchorOffset=e[g+"Offset"];f.focusNode=e[h+"Container"];f.focusOffset=e[h+"Offset"]}function ax(b){b.anchorNode=b.focusNode=null;b.anchorOffset=b.focusOffset=0;b.rangeCount=0;b.isCollapsed=!0;b._ranges.length=0}function av(b){var d;b instanceof ae?(d=b._selectionNativeRange,d||(d=aB.createNativeRange(ap.getDocument(b.startContainer)),d.setEnd(b.endContainer,b.endOffset),d.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=d,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof an?d=b.nativeRange:aB.features.implementsDomRange&&b instanceof ap.getWindow(b.startContainer).Range&&(d=b);return d}function au(f){var e=f.getNodes(),h;f:if(!e.length||1!=e[0].nodeType){h=!1}else{h=1;for(var g=e.length;h<g;++h){if(!ap.isAncestorOf(e[0],e[h])){h=!1;break f}}h=!0}if(!h){throw Error("getSingleElementFromRange: range "+f.inspect()+" did not consist of a single element")}return e[0]}function aw(e,d){var f=new an(d);e._ranges=[f];ay(e,f,!1);e.rangeCount=1;e.isCollapsed=f.collapsed}function ar(b){b._ranges.length=0;if("None"==b.docSelection.type){ax(b)}else{var h=b.docSelection.createRange();if(h&&"undefined"!=typeof h.text){aw(b,h)}else{b.rangeCount=h.length;for(var g,f=ap.getDocument(h.item(0)),e=0;e<b.rangeCount;++e){g=aB.createRange(f),g.selectNode(h.item(e)),b._ranges.push(g)}b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed;ay(b,b._ranges[b.rangeCount-1],!1)}}}function at(i,h){for(var p=i.docSelection.createRange(),o=au(h),n=ap.getDocument(p.item(0)),n=ap.getBody(n).createControlRange(),l=0,k=p.length;l<k;++l){n.add(p.item(l))}try{n.add(o)}catch(m){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}n.select();ar(i)}function al(e,d,f){this.nativeSelection=e;this.docSelection=d;this._ranges=[];this.win=f;this.refresh()}function ao(h,f){for(var l=ap.getDocument(f[0].startContainer),l=ap.getBody(l).createControlRange(),k=0,j;k<rangeCount;++k){j=au(f[k]);try{l.add(j)}catch(i){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}l.select();ar(h)}function am(d,c){if(d.anchorNode&&ap.getDocument(d.anchorNode)!==ap.getDocument(c)){throw new ac("WRONG_DOCUMENT_ERR")}}function ak(h){var f=[],n=new af(h.anchorNode,h.anchorOffset),m=new af(h.focusNode,h.focusOffset),l="function"==typeof h.getName?h.getName():"Selection";if("undefined"!=typeof h.rangeCount){for(var k=0,i=h.rangeCount;k<i;++k){f[k]=ae.inspect(h.getRangeAt(k))}}return"["+l+"(Ranges: "+f.join(", ")+")(anchor: "+n.inspect()+", focus: "+m.inspect()+"]"}aB.requireModules(["DomUtil","DomRange","WrappedRange"]);aB.config.checkSelectionRanges=!0;var ap=aB.dom,aj=aB.util,ae=aB.DomRange,an=aB.WrappedRange,ac=aB.DOMException,af=ap.DomPosition,ad,ab,ai=aB.util.isHostMethod(window,"getSelection"),ag=aB.util.isHostObject(document,"selection"),Y=ag&&(!ai||aB.config.preferTextRange);Y?(ad=az,aB.isSelectionValid=function(d){var d=(d||window).document,c=d.selection;return"None"!=c.type||ap.getDocument(c.createRange().parentElement())==d}):ai?(ad=aC,aB.isSelectionValid=function(){return !0}):aA.fail("Neither document.selection or window.getSelection() detected.");aB.getNativeSelection=ad;var ai=ad(),R=aB.createNativeRange(document),W=ap.getBody(document),X=aj.areHostObjects(ai,aj.areHostProperties(ai,["anchorOffset","focusOffset"]));aB.features.selectionHasAnchorAndFocus=X;var T=aj.isHostMethod(ai,"extend");aB.features.selectionHasExtend=T;var O="number"==typeof ai.rangeCount;aB.features.selectionHasRangeCount=O;var S=!1,Z=!0;aj.areHostMethods(ai,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof ai.rangeCount&&aB.features.implementsDomRange&&function(){var g=document.createElement("iframe");W.appendChild(g);var f=ap.getIframeDocument(g);f.open();f.write("<html><head></head><body>12</body></html>");f.close();var j=ap.getIframeWindow(g).getSelection(),i=f.documentElement.lastChild.firstChild,f=f.createRange();f.setStart(i,1);f.collapse(true);j.addRange(f);Z=j.rangeCount==1;j.removeAllRanges();var h=f.cloneRange();f.setStart(i,0);h.setEnd(i,2);j.addRange(f);j.addRange(h);S=j.rangeCount==2;f.detach();h.detach();W.removeChild(g)}();aB.features.selectionSupportsMultipleRanges=S;aB.features.collapsedNonEditableSelectionsSupported=Z;var aq=!1,ah;W&&aj.isHostMethod(W,"createControlRange")&&(ah=W.createControlRange(),aj.areHostProperties(ah,["item","add"])&&(aq=!0));aB.features.implementsControlRange=aq;ab=X?function(b){return b.anchorNode===b.focusNode&&b.anchorOffset===b.focusOffset}:function(b){return b.rangeCount?b.getRangeAt(b.rangeCount-1).collapsed:false};var aa;aj.isHostMethod(ai,"getRangeAt")?aa=function(e,d){try{return e.getRangeAt(d)}catch(f){return null}}:X&&(aa=function(b){var d=ap.getDocument(b.anchorNode),d=aB.createRange(d);d.setStart(b.anchorNode,b.anchorOffset);d.setEnd(b.focusNode,b.focusOffset);if(d.collapsed!==this.isCollapsed){d.setStart(b.focusNode,b.focusOffset);d.setEnd(b.anchorNode,b.anchorOffset)}return d});aB.getSelection=function(f){var f=f||window,d=f._rangySelection,h=ad(f),g=ag?az(f):null;if(d){d.nativeSelection=h;d.docSelection=g;d.refresh(f)}else{d=new al(h,g,f);f._rangySelection=d}return d};aB.getIframeSelection=function(b){return aB.getSelection(ap.getIframeWindow(b))};ah=al.prototype;if(!Y&&X&&aj.areHostMethods(ai,["removeAllRanges","addRange"])){ah.removeAllRanges=function(){this.nativeSelection.removeAllRanges();ax(this)};var Q=function(b,f){var e=ae.getRangeDocument(f),e=aB.createRange(e);e.collapseToPoint(f.endContainer,f.endOffset);b.nativeSelection.addRange(av(e));b.nativeSelection.extend(f.startContainer,f.startOffset);b.refresh()};ah.addRange=O?function(b,f){if(aq&&ag&&this.docSelection.type=="Control"){at(this,b)}else{if(f&&T){Q(this,b)}else{var e;if(S){e=this.rangeCount}else{this.removeAllRanges();e=0}this.nativeSelection.addRange(av(b));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==e+1){if(aB.config.checkSelectionRanges){(e=aa(this.nativeSelection,this.rangeCount-1))&&!ae.rangesEqual(e,b)&&(b=new an(e))}this._ranges[this.rangeCount-1]=b;ay(this,b,U(this.nativeSelection));this.isCollapsed=ab(this)}else{this.refresh()}}}}:function(d,c){if(c&&T){Q(this,d)}else{this.nativeSelection.addRange(av(d));this.refresh()}};ah.setRanges=function(e){if(aq&&e.length>1){ao(this,e)}else{this.removeAllRanges();for(var d=0,f=e.length;d<f;++d){this.addRange(e[d])}}}}else{if(aj.isHostMethod(ai,"empty")&&aj.isHostMethod(R,"select")&&aq&&Y){ah.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode){e=ap.getDocument(this.anchorNode)}else{if(this.docSelection.type=="Control"){var d=this.docSelection.createRange();d.length&&(e=ap.getDocument(d.item(0)).body.createTextRange())}}if(e){e.body.createTextRange().select();this.docSelection.empty()}}}catch(f){}ax(this)},ah.addRange=function(b){if(this.docSelection.type=="Control"){at(this,b)}else{an.rangeToTextRange(b).select();this._ranges[0]=b;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;ay(this,b,false)}},ah.setRanges=function(d){this.removeAllRanges();var c=d.length;c>1?ao(this,d):c&&this.addRange(d[0])}}else{return aA.fail("No means of selecting a Range or TextRange was found"),!1}}ah.getRangeAt=function(b){if(b<0||b>=this.rangeCount){throw new ac("INDEX_SIZE_ERR")}return this._ranges[b]};var V;if(Y){V=function(b){var d;if(aB.isSelectionValid(b.win)){d=b.docSelection.createRange()}else{d=ap.getBody(b.win.document).createTextRange();d.collapse(true)}b.docSelection.type=="Control"?ar(b):d&&typeof d.text!="undefined"?aw(b,d):ax(b)}}else{if(aj.isHostMethod(ai,"getRangeAt")&&"number"==typeof ai.rangeCount){V=function(b){if(aq&&ag&&b.docSelection.type=="Control"){ar(b)}else{b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount;if(b.rangeCount){for(var f=0,e=b.rangeCount;f<e;++f){b._ranges[f]=new aB.WrappedRange(b.nativeSelection.getRangeAt(f))}ay(b,b._ranges[b.rangeCount-1],U(b.nativeSelection));b.isCollapsed=ab(b)}else{ax(b)}}}}else{if(X&&"boolean"==typeof ai.isCollapsed&&"boolean"==typeof R.collapsed&&aB.features.implementsDomRange){V=function(d){var c;c=d.nativeSelection;if(c.anchorNode){c=aa(c,0);d._ranges=[c];d.rangeCount=1;c=d.nativeSelection;d.anchorNode=c.anchorNode;d.anchorOffset=c.anchorOffset;d.focusNode=c.focusNode;d.focusOffset=c.focusOffset;d.isCollapsed=ab(d)}else{ax(d)}}}else{return aA.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1}}}ah.refresh=function(d){var c=d?this._ranges.slice(0):null;V(this);if(d){d=c.length;if(d!=this._ranges.length){return false}for(;d--;){if(!ae.rangesEqual(c[d],this._ranges[d])){return false}}return true}};var M=function(h,f){var l=h.getAllRanges(),k=false;h.removeAllRanges();for(var j=0,i=l.length;j<i;++j){k||f!==l[j]?h.addRange(l[j]):k=true}h.rangeCount||ax(h)};ah.removeRange=aq?function(h){if(this.docSelection.type=="Control"){for(var f=this.docSelection.createRange(),h=au(h),n=ap.getDocument(f.item(0)),n=ap.getBody(n).createControlRange(),m,l=false,k=0,i=f.length;k<i;++k){m=f.item(k);m!==h||l?n.add(f.item(k)):l=true}n.select();ar(this)}else{M(this,h)}}:function(b){M(this,b)};var U;!Y&&X&&aB.features.implementsDomRange?(U=function(d){var c=false;d.anchorNode&&(c=ap.comparePoints(d.anchorNode,d.anchorOffset,d.focusNode,d.focusOffset)==1);return c},ah.isBackwards=function(){return U(this)}):U=ah.isBackwards=function(){return false};ah.toString=function(){for(var e=[],d=0,f=this.rangeCount;d<f;++d){e[d]=""+this._ranges[d]}return e.join("")};ah.collapse=function(b,f){am(this,b);var e=aB.createRange(ap.getDocument(b));e.collapseToPoint(b,f);this.removeAllRanges();this.addRange(e);this.isCollapsed=true};ah.collapseToStart=function(){if(this.rangeCount){var b=this._ranges[0];this.collapse(b.startContainer,b.startOffset)}else{throw new ac("INVALID_STATE_ERR")}};ah.collapseToEnd=function(){if(this.rangeCount){var b=this._ranges[this.rangeCount-1];this.collapse(b.endContainer,b.endOffset)}else{throw new ac("INVALID_STATE_ERR")}};ah.selectAllChildren=function(b){am(this,b);var d=aB.createRange(ap.getDocument(b));d.selectNodeContents(b);this.removeAllRanges();this.addRange(d)};ah.deleteFromDocument=function(){if(aq&&ag&&this.docSelection.type=="Control"){for(var e=this.docSelection.createRange(),d;e.length;){d=e.item(0);e.remove(d);d.parentNode.removeChild(d)}this.refresh()}else{if(this.rangeCount){e=this.getAllRanges();this.removeAllRanges();d=0;for(var f=e.length;d<f;++d){e[d].deleteContents()}this.addRange(e[f-1])}}};ah.getAllRanges=function(){return this._ranges.slice(0)};ah.setSingleRange=function(b){this.setRanges([b])};ah.containsNode=function(f,e){for(var h=0,g=this._ranges.length;h<g;++h){if(this._ranges[h].containsNode(f,e)){return true}}return false};ah.toHtml=function(){var e="";if(this.rangeCount){for(var e=ae.getRangeDocument(this._ranges[0]).createElement("div"),d=0,f=this._ranges.length;d<f;++d){e.appendChild(this._ranges[d].cloneContents())}e=e.innerHTML}return e};ah.getName=function(){return"WrappedSelection"};ah.inspect=function(){return ak(this)};ah.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};al.inspect=ak;aB.Selection=al;aB.selectionPrototype=ah;aB.addCreateMissingNativeApiListener(function(b){if(typeof b.getSelection=="undefined"){b.getSelection=function(){return aB.getSelection(this)}}b=null})});var Base=function(){};Base.extend=function(g,l){var h=Base.prototype.extend;Base._prototyping=!0;var k=new this;h.call(k,g);k.base=function(){};delete Base._prototyping;var j=k.constructor,i=k.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==i){this._constructing=!0,j.apply(this,arguments),delete this._constructing}else{if(null!=arguments[0]){return(arguments[0].extend||h).call(arguments[0],k)}}}};i.ancestor=this;i.extend=this.extend;i.forEach=this.forEach;i.implement=this.implement;i.prototype=k;i.toString=this.toString;i.valueOf=function(b){return"object"==b?i:j.valueOf()};h.call(i,l);"function"==typeof i.init&&i.init();return i};Base.prototype={extend:function(q,p){if(1<arguments.length){var r=this[q];if(r&&"function"==typeof p&&(!r.valueOf||r.valueOf()!=p.valueOf())&&/\bbase\b/.test(p)){var o=p.valueOf(),p=function(){var a=this.base||Base.prototype.base;this.base=r;var d=o.apply(this,arguments);this.base=a;return d};p.valueOf=function(b){return"object"==b?p:o};p.toString=Base.toString}this[q]=p}else{if(q){var n=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(n=this.extend||n);for(var m={toSource:null},k=["constructor","toString","valueOf"],j=Base._prototyping?0:1;l=k[j++];){q[l]!=m[l]&&n.call(this,l,q[l])}for(var l in q){m[l]||n.call(this,l,q[l])}}}return this}};Base=Base.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(e,h,f){for(var g in e){void 0===this.prototype[g]&&h.call(f,e[g],g,e)}},implement:function(){for(var a=0;a<arguments.length;a++){if("function"==typeof arguments[a]){arguments[a](this.prototype)}else{this.prototype.extend(arguments[a])}}return this},toString:function(){return""+this.valueOf()}});wysihtml5.browser=function(){var g=navigator.userAgent,n=document.createElement("div"),i=-1!==g.indexOf("MSIE")&&-1===g.indexOf("Opera"),m=-1!==g.indexOf("Gecko")&&-1===g.indexOf("KHTML"),l=-1!==g.indexOf("AppleWebKit/"),k=-1!==g.indexOf("Chrome/"),j=-1!==g.indexOf("Opera/");return{USER_AGENT:g,supported:function(){var f=this.USER_AGENT.toLowerCase(),c="contentEditable" in n,o=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,h=document.querySelector&&document.querySelectorAll,f=this.isIos()&&5>(/ipad|iphone|ipod/.test(f)&&f.match(/ os (\d+).+? like mac os x/)||[,0])[1]||-1!==f.indexOf("opera mobi")||-1!==f.indexOf("hpwos/");return c&&o&&h&&!f},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var b=this.USER_AGENT.toLowerCase();return -1!==b.indexOf("webkit")&&-1!==b.indexOf("mobile")},supportsSandboxedIframes:function(){return i},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return !("querySelector" in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return !m},hasCurrentStyleProperty:function(){return"currentStyle" in n},insertsLineBreaksOnReturn:function(){return m},supportsPlaceholderAttributeOn:function(b){return"placeholder" in b},supportsEvent:function(d){var c;if(!(c="on"+d in n)){n.setAttribute("on"+d,"return;"),c="function"===typeof n["on"+d]}return c},supportsEventsInIframeCorrectly:function(){return !j},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return l||m},supportsDataTransfer:function(){try{return l&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(b){return !1}},supportsHTML5Tags:function(b){b=b.createElement("div");b.innerHTML="<article>foo</article>";return"<article>foo</article>"===b.innerHTML.toLowerCase()},supportsCommand:function(){var a={formatBlock:i,insertUnorderedList:i||j,insertOrderedList:i||j},d={insertHTML:m};return function(b,o){if(!a[o]){try{return b.queryCommandSupported(o)}catch(h){}try{return b.queryCommandEnabled(o)}catch(c){return !!d[o]}}return !1}}(),doesAutoLinkingInContentEditable:function(){return i},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return m||j||l},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return m||i||j},clearsListsInContentEditableCorrectly:function(){return m||i||l},autoScrollsToCaret:function(){return !l},autoClosesUnclosedTags:function(){var d=n.cloneNode(!1),c;d.innerHTML="<p><div></div>";d=d.innerHTML.toLowerCase();c="<p></p><div></div>"===d||"<p><div></div></p>"===d;this.autoClosesUnclosedTags=function(){return c};return c},supportsNativeGetElementsByClassName:function(){return -1!==(""+document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection" in window&&"modify" in window.getSelection()},supportsClassList:function(){return"classList" in n},needsSpaceAfterLineBreak:function(){return j},supportsSpeechApiOn:function(b){return 11<=(g.match(/Chrome\/(\d+)/)||[,0])[1]&&("onwebkitspeechchange" in b||"speech" in b)},crashesWhenDefineProperty:function(a){return i&&("XMLHttpRequest"===a||"XDomainRequest"===a)},doesAsyncFocus:function(){return i},hasProblemsSettingCaretAfterImg:function(){return i},hasUndoInContextMenu:function(){return m||k||j}}}();wysihtml5.lang.array=function(a){return{contains:function(f){if(a.indexOf){return -1!==a.indexOf(f)}for(var b=0,e=a.length;b<e;b++){if(a[b]===f){return !0}}return !1},without:function(h){for(var h=wysihtml5.lang.array(h),b=[],g=0,f=a.length;g<f;g++){h.contains(a[g])||b.push(a[g])}return b},get:function(){for(var f=0,b=a.length,e=[];f<b;f++){e.push(a[f])}return e}}};wysihtml5.lang.Dispatcher=Base.extend({observe:function(a,d){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(d);return this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(e,h){this.events=this.events||{};for(var f=this.events[e]||[],g=0;g<f.length;g++){f[g].call(this,h)}return this},stopObserving:function(f,j){this.events=this.events||{};var g=0,i,h;if(f){i=this.events[f]||[];for(h=[];g<i.length;g++){i[g]!==j&&j&&h.push(i[g])}this.events[f]=h}else{this.events={}}return this}});wysihtml5.lang.object=function(a){return{merge:function(d){for(var b in d){a[b]=d[b]}return this},get:function(){return a},clone:function(){var d={},b;for(b in a){d[b]=a[b]}return d},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)}}};(function(){var a=/^\s+/,d=/\s+$/;wysihtml5.lang.string=function(b){b=""+b;return{trim:function(){return b.replace(a,"").replace(d,"")},interpolate:function(e){for(var f in e){b=this.replace("#{"+f+"}").by(e[f])}return b},replace:function(c){return{by:function(e){return b.split(c).join(e)}}}}}})();(function(g){function p(b){return b.replace(n,function(h,f){var r=(f.match(m)||[])[1]||"",q=k[r],f=f.replace(m,"");f.split(q).length>f.split(r).length&&(f+=r,r="");var i=q=f;f.length>l&&(i=i.substr(0,l)+"...");"www."===q.substr(0,4)&&(q="http://"+q);return'<a href="'+q+'">'+i+"</a>"+r})}function j(c){if(!o.contains(c.nodeName)){if(c.nodeType===g.TEXT_NODE&&c.data.match(n)){var d=c.parentNode,a;a=d.ownerDocument;var b=a._wysihtml5_tempElement;b||(b=a._wysihtml5_tempElement=a.createElement("div"));a=b;a.innerHTML="<span></span>"+p(c.data);for(a.removeChild(a.firstChild);a.firstChild;){d.insertBefore(a.firstChild,c)}d.removeChild(c)}else{d=g.lang.array(c.childNodes).get();a=d.length;for(b=0;b<a;b++){j(d[b])}return c}}}var o=g.lang.array("CODE,PRE,A,SCRIPT,HEAD,TITLE,STYLE".split(",")),n=/((https?:\/\/|www\.)[^\s<]{3,})/gi,m=/([^\w\/\-](,?))$/i,l=100,k={")":"(","]":"[","}":"{"};g.dom.autoLink=function(a){var f;j:{f=a;for(var d;f.parentNode;){f=f.parentNode;d=f.nodeName;if(o.contains(d)){f=!0;break j}if("body"===d){break}}f=!1}if(f){return a}a===a.ownerDocument.documentElement&&(a=a.ownerDocument.body);return j(a)};g.dom.autoLink.URL_REG_EXP=n})(wysihtml5);(function(d){var f=d.browser.supportsClassList(),e=d.dom;e.addClass=function(a,c){if(f){return a.classList.add(c)}e.hasClass(a,c)||(a.className+=" "+c)};e.removeClass=function(g,c){if(f){return g.classList.remove(c)}g.className=g.className.replace(RegExp("(^|\\s+)"+c+"(\\s+|$)")," ")};e.hasClass=function(g,c){if(f){return g.classList.contains(c)}var h=g.className;return 0<h.length&&(h==c||RegExp("(^|\\s)"+c+"(\\s|$)").test(h))}})(wysihtml5);wysihtml5.dom.contains=function(){var a=document.documentElement;if(a.contains){return function(c,d){d.nodeType!==wysihtml5.ELEMENT_NODE&&(d=d.parentNode);return c!==d&&c.contains(d)}}if(a.compareDocumentPosition){return function(c,d){return !!(c.compareDocumentPosition(d)&16)}}}();wysihtml5.dom.convertToList=function(){function a(c,e){var f=c.createElement("li");e.appendChild(f);return f}return function(u,v){if("UL"===u.nodeName||"OL"===u.nodeName||"MENU"===u.nodeName){return u}for(var t=u.ownerDocument,s=t.createElement(v),r=wysihtml5.lang.array(u.childNodes).get(),o=r.length,n,p,l,m,b=0;b<o;b++){m=m||a(t,s),n=r[b],p="block"===wysihtml5.dom.getStyle("display").from(n),l="BR"===n.nodeName,p?(m=m.firstChild?a(t,s):m,m.appendChild(n),m=null):l?m=m.firstChild?null:m:m.appendChild(n)}u.parentNode.replaceChild(s,u);return s}}();wysihtml5.dom.copyAttributes=function(a){return{from:function(b){return{to:function(c){for(var i,h=0,g=a.length;h<g;h++){i=a[h],b[i]&&(c[i]=b[i])}return{andTo:arguments.callee}}}}}};(function(d){var f=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],e=function(b){var i;b:for(var g=0,c=f.length;g<c;g++){if("border-box"===d.getStyle(f[g]).from(b)){i=f[g];break b}}return i?parseInt(d.getStyle("width").from(b),10)<b.offsetWidth:!1};d.copyStyles=function(a){return{from:function(l){e(l)&&(a=wysihtml5.lang.array(a).without(f));for(var k="",c=a.length,b=0,j;b<c;b++){j=a[b],k+=j+":"+d.getStyle(j).from(l)+";"}return{to:function(g){d.setStyles(k).on(g);return{andTo:arguments.callee}}}}}}})(wysihtml5.dom);(function(a){a.dom.delegate=function(h,b,g,f){return a.dom.observe(h,g,function(j){for(var e=j.target,c=a.lang.array(h.querySelectorAll(b));e&&e!==h;){if(c.contains(e)){f.call(e,j);break}e=e.parentNode}})}})(wysihtml5);wysihtml5.dom.getAsDom=function(){var a="abbr,article,aside,audio,bdi,canvas,command,datalist,details,figcaption,figure,footer,header,hgroup,keygen,mark,meter,nav,output,progress,rp,rt,ruby,svg,section,source,summary,time,track,video,wbr".split(",");return function(l,b){var b=b||document,k;if("object"===typeof l&&l.nodeType){k=b.createElement("div"),k.appendChild(l)}else{if(wysihtml5.browser.supportsHTML5Tags(b)){k=b.createElement("div"),k.innerHTML=l}else{k=b;if(!k._wysihtml5_supportsHTML5Tags){for(var j=0,i=a.length;j<i;j++){k.createElement(a[j])}k._wysihtml5_supportsHTML5Tags=!0}k=b;j=k.createElement("div");j.style.display="none";k.body.appendChild(j);try{j.innerHTML=l}catch(g){}k.body.removeChild(j);k=j}}return k}}();wysihtml5.dom.getParentElement=function(){function a(c,d){return !d||!d.length?!0:"string"===typeof d?c===d:wysihtml5.lang.array(d).contains(c)}return function(n,b,m){m=m||50;if(b.className||b.classRegExp){b:{for(var l=b.nodeName,k=b.className,b=b.classRegExp;m--&&n&&"BODY"!==n.nodeName;){var j;if(j=n.nodeType===wysihtml5.ELEMENT_NODE){if(j=a(n.nodeName,l)){j=k;var g=(n.className||"").match(b)||[];j=!j?!!g.length:g[g.length-1]===j}}if(j){break b}n=n.parentNode}n=null}return n}b:{l=b.nodeName;for(k=m;k--&&n&&"BODY"!==n.nodeName;){if(a(n.nodeName,l)){break b}n=n.parentNode}n=null}return n}}();wysihtml5.dom.getStyle=function(){function d(a){return a.replace(e,function(b){return b.charAt(1).toUpperCase()})}var f={"float":"styleFloat" in document.createElement("div").style?"styleFloat":"cssFloat"},e=/\-[a-z]/g;return function(b){return{from:function(r){if(r.nodeType===wysihtml5.ELEMENT_NODE){var p=r.ownerDocument,m=f[b]||d(b),l=r.style,n=r.currentStyle,a=l[m];if(a){return a}if(n){try{return n[m]}catch(c){}}var m=p.defaultView||p.parentWindow,p=("height"===b||"width"===b)&&"TEXTAREA"===r.nodeName,o;if(m.getComputedStyle){return p&&(o=l.overflow,l.overflow="hidden"),r=m.getComputedStyle(r,null).getPropertyValue(b),p&&(l.overflow=o||""),r}}}}}}();wysihtml5.dom.hasElementWithTagName=function(){var a={},d=1;return function(b,h){var g=(b._wysihtml5_identifier||(b._wysihtml5_identifier=d++))+":"+h,c=a[g];c||(c=a[g]=b.getElementsByTagName(h));return 0<c.length}}();(function(d){var f={},e=1;d.dom.hasElementWithClassName=function(g,c){if(!d.browser.supportsNativeGetElementsByClassName()){return !!g.querySelector("."+c)}var b=(g._wysihtml5_identifier||(g._wysihtml5_identifier=e++))+":"+c,a=f[b];a||(a=f[b]=g.getElementsByClassName(c));return 0<a.length}})(wysihtml5);wysihtml5.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}};wysihtml5.dom.insertCSS=function(a){a=a.join("\n");return{into:function(f){var b=f.head||f.getElementsByTagName("head")[0],e=f.createElement("style");e.type="text/css";e.styleSheet?e.styleSheet.cssText=a:e.appendChild(f.createTextNode(a));b&&b.appendChild(e)}}};wysihtml5.dom.observe=function(g,n,i){for(var n="string"===typeof n?[n]:n,m,l,k=0,j=n.length;k<j;k++){l=n[k],g.addEventListener?g.addEventListener(l,i,!1):(m=function(a){"target" in a||(a.target=a.srcElement);a.preventDefault=a.preventDefault||function(){this.returnValue=false};a.stopPropagation=a.stopPropagation||function(){this.cancelBubble=true};i.call(g,a)},g.attachEvent("on"+l,m))}return{stop:function(){for(var c,a=0,b=n.length;a<b;a++){c=n[a],g.removeEventListener?g.removeEventListener(c,i,!1):g.detachEvent("on"+c,m)}}}};wysihtml5.dom.parse=function(){function s(v,u){var d=v.childNodes,i=d.length,a;a=t[v.nodeType];var b=0;a=a&&a(v);if(!a){return null}for(b=0;b<i;b++){(newChild=s(d[b],u))&&a.appendChild(newChild)}return u&&1>=a.childNodes.length&&a.nodeName.toLowerCase()===q&&!a.attributes.length?a.firstChild:a}function r(g,f){var f=f.toLowerCase(),k;if(k="IMG"==g.nodeName){if(k="src"==f){var i;try{i=g.complete&&!g.mozMatchesSelector(":-moz-broken")}catch(h){g.complete&&"complete"===g.readyState&&(i=!0)}k=!0===i}}return k?g.src:l&&"outerHTML" in g?-1!=g.outerHTML.toLowerCase().indexOf(" "+f+"=")?g.getAttribute(f):null:g.getAttribute(f)}var t={1:function(D){var C,k,h=m.tags;k=D.nodeName.toLowerCase();C=D.scopeName;if(D._wysihtml5){return null}D._wysihtml5=1;if("wysihtml5-temp"===D.className){return null}C&&"HTML"!=C&&(k=C+":"+k);"outerHTML" in D&&!wysihtml5.browser.autoClosesUnclosedTags()&&"P"===D.nodeName&&"</p>"!==D.outerHTML.slice(-4).toLowerCase()&&(k="div");if(k in h){C=h[k];if(!C||C.remove){return null}C="string"===typeof C?{rename_tag:C}:C}else{if(D.firstChild){C={rename_tag:q}}else{return null}}k=D.ownerDocument.createElement(C.rename_tag||k);var h={},c=C.set_class,g=C.add_class,I=C.set_attributes,E=C.check_attributes,e=m.classes,u=0,F=[];C=[];var B=[],d=[],H;I&&(h=wysihtml5.lang.object(I).clone());if(E){for(H in E){if(I=n[E[H]]){I=I(r(D,H)),"string"===typeof I&&(h[H]=I)}}}c&&F.push(c);if(g){for(H in g){if(I=j[g[H]]){c=I(r(D,H)),"string"===typeof c&&F.push(c)}}}e["_wysihtml5-temp-placeholder"]=1;(d=D.getAttribute("class"))&&(F=F.concat(d.split(p)));for(g=F.length;u<g;u++){D=F[u],e[D]&&C.push(D)}for(e=C.length;e--;){D=C[e],wysihtml5.lang.array(B).contains(D)||B.unshift(D)}B.length&&(h["class"]=B.join(" "));for(H in h){try{k.setAttribute(H,h[H])}catch(G){}}h.src&&("undefined"!==typeof h.width&&k.setAttribute("width",h.width),"undefined"!==typeof h.height&&k.setAttribute("height",h.height));return k},3:function(b){return b.ownerDocument.createTextNode(b.data)}},q="span",p=/\s+/,o={tags:{},classes:{}},m={},l=!wysihtml5.browser.supportsGetAttributeCorrectly(),n={url:function(){var b=/^https?:\/\//i;return function(a){return !a||!a.match(b)?null:a.replace(b,function(c){return c.toLowerCase()})}}(),alt:function(){var b=/[^ a-z0-9_\-]/gi;return function(a){return !a?"":a.replace(b,"")}}(),numbers:function(){var b=/\D/g;return function(a){return(a=(a||"").replace(b,""))||null}}()},j={align_img:function(){var b={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(a){return b[(""+a).toLowerCase()]}}(),align_text:function(){var b={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(a){return b[(""+a).toLowerCase()]}}(),clear_br:function(){var b={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(a){return b[(""+a).toLowerCase()]}}(),size_font:function(){var b={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(a){return b[(""+a).charAt(0)]}}()};return function(b,k,i,h){wysihtml5.lang.object(m).merge(o).merge(k).get();for(var i=i||b.ownerDocument||document,k=i.createDocumentFragment(),f="string"===typeof b,b=f?wysihtml5.dom.getAsDom(b,i):b;b.firstChild;){i=b.firstChild,b.removeChild(i),(i=s(i,h))&&k.appendChild(i)}b.innerHTML="";b.appendChild(k);return f?wysihtml5.quirks.getCorrectInnerHTML(b):b}}();wysihtml5.dom.removeEmptyTextNodes=function(e){for(var h=wysihtml5.lang.array(e.childNodes).get(),f=h.length,g=0;g<f;g++){e=h[g],e.nodeType===wysihtml5.TEXT_NODE&&""===e.data&&e.parentNode.removeChild(e)}};wysihtml5.dom.renameElement=function(e,h){for(var f=e.ownerDocument.createElement(h),g;g=e.firstChild;){f.appendChild(g)}wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(f);e.parentNode.replaceChild(f,e);return f};wysihtml5.dom.replaceWithChildNodes=function(a){if(a.parentNode){if(a.firstChild){for(var d=a.ownerDocument.createDocumentFragment();a.firstChild;){d.appendChild(a.firstChild)}a.parentNode.replaceChild(d,a)}else{a.parentNode.removeChild(a)}}};(function(a){function d(e){var c=e.ownerDocument.createElement("br");e.appendChild(c)}a.resolveList=function(b){if(!("MENU"!==b.nodeName&&"UL"!==b.nodeName&&"OL"!==b.nodeName)){var l=b.ownerDocument.createDocumentFragment(),k=b.previousSibling,j,g,c;for(k&&"block"!==a.getStyle("display").from(k)&&d(l);c=b.firstChild;){for(j=c.lastChild;k=c.firstChild;){g=(g=k===j)&&"block"!==a.getStyle("display").from(k)&&"BR"!==k.nodeName,l.appendChild(k),g&&d(l)}c.parentNode.removeChild(c)}b.parentNode.replaceChild(l,b)}}})(wysihtml5.dom);(function(f){var j=document,g="parent,top,opener,frameElement,frames,localStorage,globalStorage,sessionStorage,indexedDB".split(","),i="open,close,openDialog,showModalDialog,alert,confirm,prompt,openDatabase,postMessage,XMLHttpRequest,XDomainRequest".split(","),h=["referrer","write","open","close"];f.dom.Sandbox=Base.extend({constructor:function(b,d){this.callback=b||f.EMPTY_FUNCTION;this.config=f.lang.object({}).merge(d).get();this.iframe=this._createIframe()},insertInto:function(b){"string"===typeof b&&(b=j.getElementById(b));b.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var b=this.getIframe();b.parentNode.removeChild(b)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var b=this,c=j.createElement("iframe");c.className="wysihtml5-sandbox";f.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(c);f.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(c.src="javascript:'<html></html>'");c.onload=function(){c.onreadystatechange=c.onload=null;b._onLoadIframe(c)};c.onreadystatechange=function(){if(/loaded|complete/.test(c.readyState)){c.onreadystatechange=c.onload=null;b._onLoadIframe(c)}};return c},_onLoadIframe:function(l){if(f.dom.contains(j.documentElement,l)){var d=this,c=l.contentWindow,e=l.contentWindow.document,a=this._getHtml({charset:j.characterSet||j.charset||"utf-8",stylesheets:this.config.stylesheets});e.open("text/html","replace");e.write(a);e.close();this.getWindow=function(){return l.contentWindow};this.getDocument=function(){return l.contentWindow.document};c.onerror=function(m,k,n){throw Error("wysihtml5.Sandbox: "+m,k,n)};if(!f.browser.supportsSandboxedIframes()){var b,a=0;for(b=g.length;a<b;a++){this._unset(c,g[a])}a=0;for(b=i.length;a<b;a++){this._unset(c,i[a],f.EMPTY_FUNCTION)}a=0;for(b=h.length;a<b;a++){this._unset(e,h[a])}this._unset(e,"cookie","",!0)}this.loaded=!0;setTimeout(function(){d.callback(d)},0)}},_getHtml:function(b){var o=b.stylesheets,n="",m=0,l;if(o="string"===typeof o?[o]:o){for(l=o.length;m<l;m++){n+='<link rel="stylesheet" href="'+o[m]+'">'}}b.stylesheets=n;return f.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(b)},_unset:function(v,u,t,s){try{v[u]=t}catch(o){}try{v.__defineGetter__(u,function(){return t})}catch(r){}if(s){try{v.__defineSetter__(u,function(){})}catch(b){}}if(!f.browser.crashesWhenDefineProperty(u)){try{var m={get:function(){return t}};s&&(m.set=function(){});Object.defineProperty(v,u,m)}catch(l){}}}})})(wysihtml5);(function(){var a={className:"class"};wysihtml5.dom.setAttributes=function(b){return{on:function(c){for(var e in b){c.setAttribute(a[e]||e,b[e])}}}}})();wysihtml5.dom.setStyles=function(a){return{on:function(d){d=d.style;if("string"===typeof a){d.cssText+=";"+a}else{for(var b in a){"float"===b?(d.cssFloat=a[b],d.styleFloat=a[b]):d[b]=a[b]}}}}};(function(a){a.simulatePlaceholder=function(j,b,i){var h=function(){b.hasPlaceholderSet()&&b.clear();a.removeClass(b.element,"placeholder")},g=function(){b.isEmpty()&&(b.setValue(i),a.addClass(b.element,"placeholder"))};j.observe("set_placeholder",g).observe("unset_placeholder",h).observe("focus:composer",h).observe("paste:composer",h).observe("blur:composer",g);g()}})(wysihtml5.dom);(function(a){var d=document.documentElement;"textContent" in d?(a.setTextContent=function(e,c){e.textContent=c},a.getTextContent=function(b){return b.textContent}):"innerText" in d?(a.setTextContent=function(e,c){e.innerText=c},a.getTextContent=function(b){return b.innerText}):(a.setTextContent=function(e,c){e.nodeValue=c},a.getTextContent=function(b){return b.nodeValue})})(wysihtml5.dom);wysihtml5.quirks.cleanPastedHTML=function(){var a={"a u":wysihtml5.dom.replaceWithChildNodes};return function(p,b,o){var b=b||a,o=o||p.ownerDocument||document,n="string"===typeof p,m,k,j,l=0,p=n?wysihtml5.dom.getAsDom(p,o):p;for(j in b){m=p.querySelectorAll(j);o=b[j];for(k=m.length;l<k;l++){o(m[l])}}return n?p.innerHTML:p}}();(function(a){var d=a.dom;a.quirks.ensureProperClearing=function(){var b=function(){var c=this;setTimeout(function(){var e=c.innerHTML.toLowerCase();if("<p>&nbsp;</p>"==e||"<p>&nbsp;</p><p>&nbsp;</p>"==e){c.innerHTML=""}},0)};return function(c){d.observe(c.element,["cut","keydown"],b)}}();a.quirks.ensureProperClearingOfLists=function(){var b=["OL","UL","MENU"];return function(c){d.observe(c.element,"keydown",function(h){if(h.keyCode===a.BACKSPACE_KEY){var g=c.selection.getSelectedNode(),h=c.element;h.firstChild&&a.lang.array(b).contains(h.firstChild.nodeName)&&(g=d.getParentElement(g,{nodeName:b}))&&g==h.firstChild&&1>=g.childNodes.length&&(g.firstChild?""===g.firstChild.innerHTML:1)&&g.parentNode.removeChild(g)}})}}()})(wysihtml5);(function(a){a.quirks.getCorrectInnerHTML=function(l){var b=l.innerHTML;if(-1===b.indexOf("%7E")){return b}var l=l.querySelectorAll("[href*='~'], [src*='~']"),k,j,i,g;g=0;for(i=l.length;g<i;g++){k=l[g].href||l[g].src,j=a.lang.string(k).replace("~").by("%7E"),b=a.lang.string(b).replace(j).by(k)}return b}})(wysihtml5);(function(e){var h=e.dom,f="LI,P,H1,H2,H3,H4,H5,H6".split(","),g=["UL","OL","MENU"];e.quirks.insertLineBreakOnReturn=function(b){function a(c){if(c=h.getParentElement(c,{nodeName:["P","DIV"]},2)){var i=document.createTextNode(e.INVISIBLE_SPACE);h.insert(i).before(c);h.replaceWithChildNodes(c);b.selection.selectNode(i)}}h.observe(b.element.ownerDocument,"keydown",function(d){var c=d.keyCode;if(!(d.shiftKey||c!==e.ENTER_KEY&&c!==e.BACKSPACE_KEY)){var j=b.selection.getSelectedNode();(j=h.getParentElement(j,{nodeName:f},4))?"LI"===j.nodeName&&(c===e.ENTER_KEY||c===e.BACKSPACE_KEY)?setTimeout(function(){var k=b.selection.getSelectedNode(),i;k&&((i=h.getParentElement(k,{nodeName:g},2))||a(k))},0):j.nodeName.match(/H[1-6]/)&&c===e.ENTER_KEY&&setTimeout(function(){a(b.selection.getSelectedNode())},0):c===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(b.commands.exec("insertLineBreak"),d.preventDefault())}})}})(wysihtml5);(function(a){a.quirks.redraw=function(f){a.dom.addClass(f,"wysihtml5-quirks-redraw");a.dom.removeClass(f,"wysihtml5-quirks-redraw");try{var b=f.ownerDocument;b.execCommand("italic",!1,null);b.execCommand("italic",!1,null)}catch(e){}}})(wysihtml5);(function(a){var d=a.dom;a.Selection=Base.extend({constructor:function(b){window.rangy.init();this.editor=b;this.composer=b.composer;this.doc=this.composer.doc},getBookmark:function(){var b=this.getRange();return b&&b.cloneRange()},setBookmark:function(b){b&&this.setSelection(b)},setBefore:function(e){var c=rangy.createRange(this.doc);c.setStartBefore(e);c.setEndBefore(e);return this.setSelection(c)},setAfter:function(e){var c=rangy.createRange(this.doc);c.setStartAfter(e);c.setEndAfter(e);return this.setSelection(c)},selectNode:function(b){var n=rangy.createRange(this.doc),m=b.nodeType===a.ELEMENT_NODE,l="canHaveHTML" in b?b.canHaveHTML:"IMG"!==b.nodeName,j=m?b.innerHTML:b.data,j=""===j||j===a.INVISIBLE_SPACE,c=d.getStyle("display").from(b),c="block"===c||"list-item"===c;if(j&&m&&l){try{b.innerHTML=a.INVISIBLE_SPACE}catch(k){}}l?n.selectNodeContents(b):n.selectNode(b);l&&j&&m?n.collapse(c):l&&j&&(n.setStartAfter(b),n.setEndAfter(b));this.setSelection(n)},getSelectedNode:function(b){if(b&&this.doc.selection&&"Control"===this.doc.selection.type&&(b=this.doc.selection.createRange())&&b.length){return b.item(0)}b=this.getSelection(this.doc);return b.focusNode===b.anchorNode?b.focusNode:(b=this.getRange(this.doc))?b.commonAncestorContainer:this.doc.body},executeAndRestore:function(s,r){var q=this.doc.body,p=r&&q.scrollTop,n=r&&q.scrollLeft,m='<span class="_wysihtml5-temp-placeholder">'+a.INVISIBLE_SPACE+"</span>",o=this.getRange(this.doc);if(o){m=o.createContextualFragment(m);o.insertNode(m);try{s(o.startContainer,o.endContainer)}catch(b){setTimeout(function(){throw b},0)}(caretPlaceholder=this.doc.querySelector("._wysihtml5-temp-placeholder"))?(o=rangy.createRange(this.doc),o.selectNode(caretPlaceholder),o.deleteContents(),this.setSelection(o)):q.focus();r&&(q.scrollTop=p,q.scrollLeft=n);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(l){}}else{s(q,q)}},executeAndRestoreSimple:function(u){var t,s,r=this.getRange(),o=this.doc.body,n;if(r){t=r.getNodes([3]);o=t[0]||r.startContainer;n=t[t.length-1]||r.endContainer;t=o===r.startContainer?r.startOffset:0;s=n===r.endContainer?r.endOffset:n.length;try{u(r.startContainer,r.endContainer)}catch(p){setTimeout(function(){throw p},0)}u=rangy.createRange(this.doc);try{u.setStart(o,t)}catch(l){}try{u.setEnd(n,s)}catch(m){}try{this.setSelection(u)}catch(e){}}else{u(o,o)}},insertHTML:function(e){var e=rangy.createRange(this.doc).createContextualFragment(e),c=e.lastChild;this.insertNode(e);c&&this.setAfter(c)},insertNode:function(e){var c=this.getRange();c&&c.insertNode(e)},surround:function(f){var e=this.getRange();if(e){try{e.surroundContents(f),this.selectNode(f)}catch(g){f.appendChild(e.extractContents()),e.insertNode(f)}}},scrollIntoView:function(){var b=this.doc,i=b.documentElement.scrollHeight>b.documentElement.offsetHeight,h;if(!(h=b._wysihtml5ScrollIntoViewElement)){h=b.createElement("span"),h.innerHTML=a.INVISIBLE_SPACE}h=b._wysihtml5ScrollIntoViewElement=h;if(i){this.insertNode(h);var i=h,g=0;if(i.parentNode){do{g+=i.offsetTop||0,i=i.offsetParent}while(i)}i=g;h.parentNode.removeChild(h);i>b.body.scrollTop&&(b.body.scrollTop=i)}},selectLine:function(){a.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var b=this.doc.defaultView.getSelection();b.modify("extend","left","lineboundary");b.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var g=this.doc.selection.createRange(),e=g.boundingTop,m=this.doc.body.scrollWidth,l;if(g.moveToPoint){0===e&&(l=this.doc.createElement("span"),this.insertNode(l),e=l.offsetTop,l.parentNode.removeChild(l));e+=1;for(l=-10;l<m;l+=2){try{g.moveToPoint(l,e);break}catch(k){}}for(l=this.doc.selection.createRange();0<=m;m--){try{l.moveToPoint(m,e);break}catch(j){}}g.setEndPoint("EndToEnd",l);g.select()}},getText:function(){var b=this.getSelection();return b?b.toString():""},getNodes:function(f,e){var g=this.getRange();return g?g.getNodes([f],e):[]},getRange:function(){var b=this.getSelection();return b&&b.rangeCount&&b.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(b){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow).setSingleRange(b)}})})(wysihtml5);(function(g,p){function j(d,c){return p.dom.isCharacterDataNode(d)?0==c?!!d.previousSibling:c==d.length?!!d.nextSibling:!0:0<c&&c<d.childNodes.length}function o(d,c,r){var q;p.dom.isCharacterDataNode(c)&&(0==r?(r=p.dom.getNodeIndex(c),c=c.parentNode):r==c.length?(r=p.dom.getNodeIndex(c)+1,c=c.parentNode):q=p.dom.splitDataNode(c,r));if(!q){q=c.cloneNode(!1);q.id&&q.removeAttribute("id");for(var i;i=c.childNodes[r];){q.appendChild(i)}p.dom.insertAfter(q,c)}return c==d?q:o(d,q.parentNode,p.dom.getNodeIndex(q))}function n(b){this.firstTextNode=(this.isElementMerge=b.nodeType==g.ELEMENT_NODE)?b.lastChild:b;this.textNodes=[this.firstTextNode]}function m(f,e,i,h){this.tagNames=f||[l];this.cssClass=e||"";this.similarClassRegExp=i;this.normalize=h;this.applyToAnyTagName=!1}var l="span",k=/\s+/g;n.prototype={doMerge:function(){for(var h=[],f,r,q=0,i=this.textNodes.length;q<i;++q){f=this.textNodes[q],r=f.parentNode,h[q]=f.data,q&&(r.removeChild(f),r.hasChildNodes()||r.parentNode.removeChild(r))}return this.firstTextNode.data=h=h.join("")},getLength:function(){for(var d=this.textNodes.length,c=0;d--;){c+=this.textNodes[d].length}return c},toString:function(){for(var e=[],d=0,f=this.textNodes.length;d<f;++d){e[d]="'"+this.textNodes[d].data+"'"}return"[Merge("+e.join(",")+")]"}};m.prototype={getAncestorWithClass:function(b){for(var f;b;){if(this.cssClass){if(f=this.cssClass,b.className){var c=b.className.match(this.similarClassRegExp)||[];f=c[c.length-1]===f}else{f=!1}}else{f=!0}if(b.nodeType==g.ELEMENT_NODE&&p.dom.arrayContains(this.tagNames,b.tagName.toLowerCase())&&f){return b}b=b.parentNode}return !1},postApply:function(F,D){for(var B=F[0],v=F[F.length-1],u=[],t,r=B,q=v,H=0,E=v.length,e,A,G=0,C=F.length;G<C;++G){if(e=F[G],A=this.getAdjacentMergeableTextNode(e.parentNode,!1)){if(t||(t=new n(A),u.push(t)),t.textNodes.push(e),e===B&&(r=t.firstTextNode,H=r.length),e===v){q=t.firstTextNode,E=t.getLength()}}else{t=null}}if(B=this.getAdjacentMergeableTextNode(v.parentNode,!0)){t||(t=new n(v),u.push(t)),t.textNodes.push(B)}if(u.length){G=0;for(C=u.length;G<C;++G){u[G].doMerge()}D.setStart(r,H);D.setEnd(q,E)}},getAdjacentMergeableTextNode:function(b,r){var q=b.nodeType==g.TEXT_NODE,i=q?b.parentNode:b,h=r?"nextSibling":"previousSibling";if(q){if((q=b[h])&&q.nodeType==g.TEXT_NODE){return q}}else{if((q=i[h])&&this.areElementsMergeable(b,q)){return q[r?"firstChild":"lastChild"]}}return null},areElementsMergeable:function(i,c){var t;if(t=p.dom.arrayContains(this.tagNames,(i.tagName||"").toLowerCase())){if(t=p.dom.arrayContains(this.tagNames,(c.tagName||"").toLowerCase())){if(t=i.className.replace(k," ")==c.className.replace(k," ")){i:if(i.attributes.length!=c.attributes.length){t=!1}else{t=0;for(var s=i.attributes.length,r,q;t<s;++t){if(r=i.attributes[t],q=r.name,"class"!=q&&(q=c.attributes.getNamedItem(q),r.specified!=q.specified||r.specified&&r.nodeValue!==q.nodeValue)){t=!1;break i}}t=!0}}}}return t},createContainer:function(b){b=b.createElement(this.tagNames[0]);this.cssClass&&(b.className=this.cssClass);return b},applyToTextNode:function(d){var c=d.parentNode;1==c.childNodes.length&&p.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())?this.cssClass&&(d=this.cssClass,c.className?(c.className&&(c.className=c.className.replace(this.similarClassRegExp,"")),c.className+=" "+d):c.className=d):(c=this.createContainer(p.dom.getDocument(d)),d.parentNode.insertBefore(c,d),c.appendChild(d))},isRemovable:function(b){return p.dom.arrayContains(this.tagNames,b.tagName.toLowerCase())&&g.lang.string(b.className).trim()==this.cssClass},undoToTextNode:function(a,f,d){f.containsNode(d)||(a=f.cloneRange(),a.selectNode(d),a.isPointInRange(f.endContainer,f.endOffset)&&j(f.endContainer,f.endOffset)&&(o(d,f.endContainer,f.endOffset),f.setEndAfter(d)),a.isPointInRange(f.startContainer,f.startOffset)&&j(f.startContainer,f.startOffset)&&(d=o(d,f.startContainer,f.startOffset)));this.similarClassRegExp&&d.className&&(d.className=d.className.replace(this.similarClassRegExp,""));if(this.isRemovable(d)){f=d;for(d=f.parentNode;f.firstChild;){d.insertBefore(f.firstChild,f)}d.removeChild(f)}},applyToRange:function(b){var t=b.getNodes([g.TEXT_NODE]);if(!t.length){try{var s=this.createContainer(b.endContainer.ownerDocument);b.surroundContents(s);this.selectNode(b,s);return}catch(r){}}b.splitBoundaries();t=b.getNodes([g.TEXT_NODE]);if(t.length){for(var q=0,i=t.length;q<i;++q){s=t[q],this.getAncestorWithClass(s)||this.applyToTextNode(s)}b.setStart(t[0],0);s=t[t.length-1];b.setEnd(s,s.length);this.normalize&&this.postApply(t,b)}},undoToRange:function(b){var t=b.getNodes([g.TEXT_NODE]),s,r;t.length?(b.splitBoundaries(),t=b.getNodes([g.TEXT_NODE])):(t=b.endContainer.ownerDocument.createTextNode(g.INVISIBLE_SPACE),b.insertNode(t),b.selectNode(t),t=[t]);for(var q=0,i=t.length;q<i;++q){s=t[q],(r=this.getAncestorWithClass(s))&&this.undoToTextNode(s,b,r)}1==i?this.selectNode(b,t[0]):(b.setStart(t[0],0),s=t[t.length-1],b.setEnd(s,s.length),this.normalize&&this.postApply(t,b))},selectNode:function(b,t){var s=t.nodeType===g.ELEMENT_NODE,r="canHaveHTML" in t?t.canHaveHTML:!0,q=s?t.innerHTML:t.data;if((q=""===q||q===g.INVISIBLE_SPACE)&&s&&r){try{t.innerHTML=g.INVISIBLE_SPACE}catch(i){}}b.selectNodeContents(t);q&&s?b.collapse(!1):q&&(b.setStartAfter(t),b.setEndAfter(t))},getTextSelectedByRange:function(f,e){var i=e.cloneRange();i.selectNodeContents(f);var h=i.intersection(e),h=h?h.toString():"";i.detach();return h},isAppliedToRange:function(b){var v=[],u,t=b.getNodes([g.TEXT_NODE]);if(!t.length){return(u=this.getAncestorWithClass(b.startContainer))?[u]:!1}for(var s=0,r=t.length,q;s<r;++s){q=this.getTextSelectedByRange(t[s],b);u=this.getAncestorWithClass(t[s]);if(""!=q&&!u){return !1}v.push(u)}return v},toggleRange:function(b){this.isAppliedToRange(b)?this.undoToRange(b):this.applyToRange(b)}};g.selection.HTMLApplier=m})(wysihtml5,rangy);wysihtml5.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return wysihtml5.browser.supportsCommand(this.doc,a)},exec:function(f,j){var g=wysihtml5.commands[f],i=g&&g.exec;this.editor.fire("beforecommand:composer");if(i){return i.call(g,this.composer,f,j)}try{return this.doc.execCommand(f,!1,j)}catch(h){}this.editor.fire("aftercommand:composer")},state:function(f,j){var g=wysihtml5.commands[f],i=g&&g.state;if(i){return i.call(g,this.composer,f,j)}try{return this.doc.queryCommandState(f)}catch(h){return !1}},value:function(e){var h=wysihtml5.commands[e],f=h&&h.value;if(f){return f.call(h,this.composer,e)}try{return this.doc.queryCommandValue(e)}catch(g){return null}}});(function(a){a.commands.bold={exec:function(d,b){return a.commands.formatInline.exec(d,b,"b")},state:function(d,b){return a.commands.formatInline.state(d,b,"b")},value:function(){}}})(wysihtml5);(function(f){function j(p,e){var d=p.doc,l="_wysihtml5-temp-"+ +new Date,a=0,b,m,o;f.commands.formatInline.exec(p,g,i,l,/non-matching-class/g);b=d.querySelectorAll(i+"."+l);for(l=b.length;a<l;a++){for(o in m=b[a],m.removeAttribute("class"),e){m.setAttribute(o,e[o])}}a=m;1===l&&(o=h.getTextContent(m),l=!!m.querySelector("*"),o=""===o||o===f.INVISIBLE_SPACE,!l&&o&&(h.setTextContent(m,m.href),d=d.createTextNode(" "),p.selection.setAfter(m),p.selection.insertNode(d),a=d));p.selection.setAfter(a)}var g,i="A",h=f.dom;f.commands.createLink={exec:function(e,c,l){var k=this.state(e,c);k?e.selection.executeAndRestore(function(){for(var n=k.length,m=0,q,p,o;m<n;m++){q=k[m],p=h.getParentElement(q,{nodeName:"code"}),o=h.getTextContent(q),o.match(h.autoLink.URL_REG_EXP)&&!p?h.renameElement(q,"code"):h.replaceWithChildNodes(q)}}):(l="object"===typeof l?l:{href:l},j(e,l))},state:function(b,d){return f.commands.formatInline.state(b,d,"A")},value:function(){return g}}})(wysihtml5);(function(a){var d=/wysiwyg-font-size-[a-z]+/g;a.commands.fontSize={exec:function(b,f,c){return a.commands.formatInline.exec(b,f,"span","wysiwyg-font-size-"+c,d)},state:function(b,f,c){return a.commands.formatInline.state(b,f,"span","wysiwyg-font-size-"+c,d)},value:function(){}}})(wysihtml5);(function(a){var d=/wysiwyg-color-[a-z]+/g;a.commands.foreColor={exec:function(b,f,c){return a.commands.formatInline.exec(b,f,"span","wysiwyg-color-"+c,d)},state:function(b,f,c){return a.commands.formatInline.state(b,f,"span","wysiwyg-color-"+c,d)},value:function(){}}})(wysihtml5);(function(g){function p(b){for(b=b.previousSibling;b&&b.nodeType===g.TEXT_NODE&&!g.lang.string(b.data).trim();){b=b.previousSibling}return b}function j(b){for(b=b.nextSibling;b&&b.nodeType===g.TEXT_NODE&&!g.lang.string(b.data).trim();){b=b.nextSibling}return b}function o(b){return"BR"===b.nodeName||"block"===l.getStyle("display").from(b)?!0:!1}function n(b,r,q,i){if(i){var h=l.observe(b,"DOMNodeInserted",function(d){var d=d.target,e;d.nodeType===g.ELEMENT_NODE&&(e=l.getStyle("display").from(d),"inline"!==e.substr(0,6)&&(d.className+=" "+i))})}b.execCommand(r,!1,q);h&&h.stop()}function m(a,i){a.selection.selectLine();a.selection.surround(i);var h=j(i),c=p(i);h&&"BR"===h.nodeName&&h.parentNode.removeChild(h);c&&"BR"===c.nodeName&&c.parentNode.removeChild(c);(h=i.lastChild)&&"BR"===h.nodeName&&h.parentNode.removeChild(h);a.selection.selectNode(i)}var l=g.dom,k="H1,H2,H3,H4,H5,H6,P,BLOCKQUOTE,DIV".split(",");g.commands.formatBlock={exec:function(e,b,c,f,i){var h=e.doc,d=this.state(e,b,c,f,i),a,c="string"===typeof c?c.toUpperCase():c;if(d){e.selection.executeAndRestoreSimple(function(){i&&(d.className=d.className.replace(i,""));var t=!!g.lang.string(d.className).trim();if(!t&&d.nodeName===(c||"DIV")){var t=d,s=t.ownerDocument,r=j(t),q=p(t);r&&!o(r)&&t.parentNode.insertBefore(s.createElement("br"),r);q&&!o(q)&&t.parentNode.insertBefore(s.createElement("br"),t);l.replaceWithChildNodes(d)}else{t&&l.renameElement(d,"DIV")}})}else{if(null===c||g.lang.array(k).contains(c)){if(a=e.selection.getSelectedNode(),d=l.getParentElement(a,{nodeName:k})){e.selection.executeAndRestoreSimple(function(){c&&(d=l.renameElement(d,c));if(f){var q=d;q.className?(q.className=q.className.replace(i,""),q.className+=" "+f):q.className=f}});return}}e.commands.support(b)?n(h,b,c||"DIV",f):(d=h.createElement(c||"DIV"),f&&(d.className=f),m(e,d))}},state:function(h,f,r,q,i){r="string"===typeof r?r.toUpperCase():r;h=h.selection.getSelectedNode();return l.getParentElement(h,{nodeName:r,className:q,classRegExp:i})},value:function(){}}})(wysihtml5);(function(e){function h(o,n,l){var d=o+":"+n;if(!g[d]){var m=g,a=e.selection.HTMLApplier,b=f[o],o=b?[o.toLowerCase(),b.toLowerCase()]:[o.toLowerCase()];m[d]=new a(o,n,l,!0)}return g[d]}var f={strong:"b",em:"i",b:"strong",i:"em"},g={};e.commands.formatInline={exec:function(j,c,m,k,l){c=j.selection.getRange();if(!c){return !1}h(m,k,l).toggleRange(c);j.selection.setSelection(c)},state:function(m,l,c,b,j){var l=m.doc,a=f[c]||c;if(!e.dom.hasElementWithTagName(l,c)&&!e.dom.hasElementWithTagName(l,a)||b&&!e.dom.hasElementWithClassName(l,b)){return !1}m=m.selection.getRange();return !m?!1:h(c,b,j).isAppliedToRange(m)},value:function(){}}})(wysihtml5);(function(a){a.commands.insertHTML={exec:function(c,e,f){c.commands.support(e)?c.doc.execCommand(e,!1,f):c.selection.insertHTML(f)},state:function(){return !1},value:function(){}}})(wysihtml5);(function(a){a.commands.insertImage={exec:function(j,b,i){var i="object"===typeof i?i:{src:i},h=j.doc,b=this.state(j),g;if(b){j.selection.setBefore(b),i=b.parentNode,i.removeChild(b),a.dom.removeEmptyTextNodes(i),"A"===i.nodeName&&!i.firstChild&&(j.selection.setAfter(i),i.parentNode.removeChild(i)),a.quirks.redraw(j.element)}else{b=h.createElement("IMG");for(g in i){b[g]=i[g]}j.selection.insertNode(b);a.browser.hasProblemsSettingCaretAfterImg()?(i=h.createTextNode(a.INVISIBLE_SPACE),j.selection.insertNode(i),j.selection.setAfter(i)):j.selection.setAfter(b)}},state:function(d){var b;if(!a.dom.hasElementWithTagName(d.doc,"IMG")){return !1}b=d.selection.getSelectedNode();if(!b){return !1}if("IMG"===b.nodeName){return b}if(b.nodeType!==a.ELEMENT_NODE){return !1}b=d.selection.getText();if(b=a.lang.string(b).trim()){return !1}d=d.selection.getNodes(a.ELEMENT_NODE,function(c){return"IMG"===c.nodeName});return 1!==d.length?!1:d[0]},value:function(c){return(c=this.state(c))&&c.src}}})(wysihtml5);(function(a){var d="<br>"+(a.browser.needsSpaceAfterLineBreak()?" ":"");a.commands.insertLineBreak={exec:function(b,c){b.commands.support(c)?(b.doc.execCommand(c,!1,null),a.browser.autoScrollsToCaret()||b.selection.scrollIntoView()):b.commands.exec("insertHTML",d)},state:function(){return !1},value:function(){}}})(wysihtml5);(function(a){a.commands.insertOrderedList={exec:function(l,b){var k=l.doc,j,i,g;l.commands.support(b)?k.execCommand(b,!1,null):(j=l.selection.getSelectedNode(),(g=a.dom.getParentElement(j,{nodeName:["UL","OL"]},4))?l.selection.executeAndRestoreSimple(function(){"OL"===g.nodeName?a.dom.resolveList(g):("UL"===g.nodeName||"MENU"===g.nodeName)&&a.dom.renameElement(g,"ol")}):(i=k.createElement("span"),l.selection.surround(i),k=""===i.innerHTML||i.innerHTML===a.INVISIBLE_SPACE,l.selection.executeAndRestoreSimple(function(){g=a.dom.convertToList(i,"ol")}),k&&l.selection.selectNode(g.querySelector("li"))))},state:function(c,e){try{return c.doc.queryCommandState(e)}catch(f){return !1}},value:function(){}}})(wysihtml5);(function(a){a.commands.insertUnorderedList={exec:function(l,b){var k=l.doc,j,i,g;l.commands.support(b)?k.execCommand(b,!1,null):(j=l.selection.getSelectedNode(),(g=a.dom.getParentElement(j,{nodeName:["UL","OL"]}))?l.selection.executeAndRestoreSimple(function(){"UL"===g.nodeName?a.dom.resolveList(g):("OL"===g.nodeName||"MENU"===g.nodeName)&&a.dom.renameElement(g,"ul")}):(i=k.createElement("span"),l.selection.surround(i),k=""===i.innerHTML||i.innerHTML===a.INVISIBLE_SPACE,l.selection.executeAndRestoreSimple(function(){g=a.dom.convertToList(i,"ul")}),k&&l.selection.selectNode(g.querySelector("li"))))},state:function(c,e){try{return c.doc.queryCommandState(e)}catch(f){return !1}},value:function(){}}})(wysihtml5);(function(a){a.commands.italic={exec:function(d,b){return a.commands.formatInline.exec(d,b,"i")},state:function(d,b){return a.commands.formatInline.state(d,b,"i")},value:function(){}}})(wysihtml5);(function(a){var d=/wysiwyg-text-align-[a-z]+/g;a.commands.justifyCenter={exec:function(b){return a.commands.formatBlock.exec(b,"formatBlock",null,"wysiwyg-text-align-center",d)},state:function(b){return a.commands.formatBlock.state(b,"formatBlock",null,"wysiwyg-text-align-center",d)},value:function(){}}})(wysihtml5);(function(a){var d=/wysiwyg-text-align-[a-z]+/g;a.commands.justifyLeft={exec:function(b){return a.commands.formatBlock.exec(b,"formatBlock",null,"wysiwyg-text-align-left",d)},state:function(b){return a.commands.formatBlock.state(b,"formatBlock",null,"wysiwyg-text-align-left",d)},value:function(){}}})(wysihtml5);(function(a){var d=/wysiwyg-text-align-[a-z]+/g;a.commands.justifyRight={exec:function(b){return a.commands.formatBlock.exec(b,"formatBlock",null,"wysiwyg-text-align-right",d)},state:function(b){return a.commands.formatBlock.state(b,"formatBlock",null,"wysiwyg-text-align-right",d)},value:function(){}}})(wysihtml5);(function(a){var d=/wysiwyg-text-decoration-underline/g;a.commands.underline={exec:function(b,c){return a.commands.formatInline.exec(b,c,"span","wysiwyg-text-decoration-underline",d)},state:function(b,c){return a.commands.formatInline.state(b,c,"span","wysiwyg-text-decoration-underline",d)},value:function(){}}})(wysihtml5);(function(e){var h='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",f='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",g=e.dom;e.UndoManager=e.lang.Dispatcher.extend({constructor:function(b){this.editor=b;this.composer=b.composer;this.element=this.composer.element;this.history=[this.composer.getValue()];this.position=1;this.composer.commands.support("insertHTML")&&this._observe()},_observe:function(){var l=this,j=this.composer.sandbox.getDocument(),c;g.observe(this.element,"keydown",function(k){if(!(k.altKey||!k.ctrlKey&&!k.metaKey)){var i=k.keyCode,m=90===i&&k.shiftKey||89===i;90===i&&!k.shiftKey?(l.undo(),k.preventDefault()):m&&(l.redo(),k.preventDefault())}});g.observe(this.element,"keydown",function(i){i=i.keyCode;i!==c&&(c=i,(8===i||46===i)&&l.transact())});if(e.browser.hasUndoInContextMenu()){var b,d,a=function(){for(var i;i=j.querySelector("._wysihtml5-temp");){i.parentNode.removeChild(i)}clearInterval(b)};g.observe(this.element,"contextmenu",function(){a();l.composer.selection.executeAndRestoreSimple(function(){l.element.lastChild&&l.composer.selection.setAfter(l.element.lastChild);j.execCommand("insertHTML",!1,h);j.execCommand("insertHTML",!1,f);j.execCommand("undo",!1,null)});b=setInterval(function(){j.getElementById("_wysihtml5-redo")?(a(),l.redo()):j.getElementById("_wysihtml5-undo")||(a(),l.undo())},400);d||(d=!0,g.observe(document,"mousedown",a),g.observe(j,["mousedown","paste","cut","copy"],a))})}this.editor.observe("newword:composer",function(){l.transact()}).observe("beforecommand:composer",function(){l.transact()})},transact:function(){var d=this.history[this.position-1],c=this.composer.getValue();if(c!=d){if(40<(this.history.length=this.position)){this.history.shift(),this.position--}this.position++;this.history.push(c)}},undo:function(){this.transact();1>=this.position||(this.set(this.history[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.position>=this.history.length||(this.set(this.history[++this.position-1]),this.editor.fire("redo:composer"))},set:function(b){this.composer.setValue(b);this.editor.focus(!0)}})})(wysihtml5);wysihtml5.views.View=Base.extend({constructor:function(d,f,e){this.parent=d;this.element=f;this.config=e;this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.observe("beforeload",function(){a.parent.observe("change_view",function(b){b===a.name?(a.parent.currentView=a,a.show(),setTimeout(function(){a.focus()},0)):a.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element){try{this.element.focus()}catch(a){}}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});(function(d){var f=d.dom,e=d.browser;d.views.Composer=d.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(h,g,i){this.base(h,g,i);this.textarea=this.parent.textarea;this._initSandbox()},clear:function(){this.element.innerHTML=e.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(b){var g=this.isEmpty()?"":d.quirks.getCorrectInnerHTML(this.element);b&&(g=this.parent.parse(g));return g=d.lang.string(g).replace(d.INVISIBLE_SPACE).by("")},setValue:function(g,c){c&&(g=this.parent.parse(g));this.element.innerHTML=g},show:function(){this.iframe.style.display=this._displayStyle||"";this.disable();this.enable()},hide:function(){this._displayStyle=f.getStyle("display").from(this.iframe);"none"===this._displayStyle&&(this._displayStyle=null);this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable");this.base()},enable:function(){this.element.setAttribute("contentEditable","true");this.base()},focus:function(b){d.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear();this.base();var g=this.element.lastChild;b&&g&&("BR"===g.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return f.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var b=this.element.innerHTML;return""===b||b===this.CARET_HACK||this.hasPlaceholderSet()||""===this.getTextContent()&&!this.element.querySelector("blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea")},_initSandbox:function(){var g=this;this.sandbox=new f.Sandbox(function(){g._create()},{stylesheets:this.config.stylesheets});this.iframe=this.sandbox.getIframe();var c=document.createElement("input");c.type="hidden";c.name="_wysihtml5_mode";c.value=1;var h=this.textarea.element;f.insert(this.iframe).after(h);f.insert(c).after(h)},_create:function(){var b=this;this.doc=this.sandbox.getDocument();this.element=this.doc.body;this.textarea=this.parent.textarea;this.element.innerHTML=this.textarea.getValue(!0);this.enable();this.selection=new d.Selection(this.parent);this.commands=new d.Commands(this.parent);f.copyAttributes("className,spellcheck,title,lang,dir,accessKey".split(",")).from(this.textarea.element).to(this.element);f.addClass(this.element,this.config.composerClassName);this.config.style&&this.style();this.observe();var a=this.config.name;a&&(f.addClass(this.element,a),f.addClass(this.iframe,a));(a="string"===typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder"))&&f.simulatePlaceholder(this.parent,this,a);this.commands.exec("styleWithCSS",!1);this._initAutoLinking();this._initObjectResizing();this._initUndoManager();(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){b.focus()},100);d.quirks.insertLineBreakOnReturn(this);e.clearsContentEditableCorrectly()||d.quirks.ensureProperClearing(this);e.clearsListsInContentEditableCorrectly()||d.quirks.ensureProperClearingOfLists(this);this.initSync&&this.config.sync&&this.initSync();this.textarea.hide();this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var l=this,k=e.canDisableAutoLinking(),j=e.doesAutoLinkingInContentEditable();k&&this.commands.exec("autoUrlDetect",!1);if(this.config.autoLink){(!j||j&&k)&&this.parent.observe("newword:composer",function(){l.selection.executeAndRestore(function(h,g){f.autoLink(g.parentNode)})});var b=this.sandbox.getDocument().getElementsByTagName("a"),a=f.autoLink.URL_REG_EXP,c=function(g){g=d.lang.string(f.getTextContent(g)).trim();"www."===g.substr(0,4)&&(g="http://"+g);return g};f.observe(this.element,"keydown",function(h){if(b.length){var h=l.selection.getSelectedNode(h.target.ownerDocument),g=f.getParentElement(h,{nodeName:"A"},4),i;g&&(i=c(g),setTimeout(function(){var m=c(g);m!==i&&m.match(a)&&g.setAttribute("href",m)},0))}})}},_initObjectResizing:function(){var c=["width","height"],b=c.length,a=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing);this.config.allowObjectResizing?e.supportsEvent("resizeend")&&f.observe(a,"resizeend",function(h){for(var h=h.target||h.srcElement,l=h.style,j=0,i;j<b;j++){i=c[j],l[i]&&(h.setAttribute(i,parseInt(l[i],10)),l[i]="")}d.quirks.redraw(a)}):e.supportsEvent("resizestart")&&f.observe(a,"resizestart",function(g){g.preventDefault()})},_initUndoManager:function(){new d.UndoManager(this.parent)}})})(wysihtml5);(function(s){var r=s.dom,t=document,q=window,p=t.createElement("div"),o="background-color,color,cursor,font-family,font-size,font-style,font-variant,font-weight,line-height,letter-spacing,text-align,text-decoration,text-indent,text-rendering,word-break,word-wrap,word-spacing".split(","),m="background-color,border-collapse,border-bottom-color,border-bottom-style,border-bottom-width,border-left-color,border-left-style,border-left-width,border-right-color,border-right-style,border-right-width,border-top-color,border-top-style,border-top-width,clear,display,float,margin-bottom,margin-left,margin-right,margin-top,outline-color,outline-offset,outline-width,outline-style,padding-left,padding-right,padding-top,padding-bottom,position,top,left,right,bottom,z-index,vertical-align,text-align,-webkit-box-sizing,-moz-box-sizing,-ms-box-sizing,box-sizing,-webkit-box-shadow,-moz-box-shadow,-ms-box-shadow,box-shadow,-webkit-border-top-right-radius,-moz-border-radius-topright,border-top-right-radius,-webkit-border-bottom-right-radius,-moz-border-radius-bottomright,border-bottom-right-radius,-webkit-border-bottom-left-radius,-moz-border-radius-bottomleft,border-bottom-left-radius,-webkit-border-top-left-radius,-moz-border-radius-topleft,border-top-left-radius,width,height".split(","),l="width,height,top,left,right,bottom".split(","),n=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",s.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],j=function(a){if(a.setActive){try{a.setActive()}catch(k){}}else{var i=a.style,d=t.documentElement.scrollTop||t.body.scrollTop,c=t.documentElement.scrollLeft||t.body.scrollLeft,i={position:i.position,top:i.top,left:i.left,WebkitUserSelect:i.WebkitUserSelect};r.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(a);a.focus();r.setStyles(i).on(a);q.scrollTo&&q.scrollTo(c,d)}};s.views.Composer.prototype.style=function(){var b=this,d=t.querySelector(":focus"),f=this.textarea.element,e=f.hasAttribute("placeholder"),c=e&&f.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||p.cloneNode(!1);this.blurStylesHost=this.blurStylesHost||p.cloneNode(!1);e&&f.removeAttribute("placeholder");f===d&&f.blur();r.copyStyles(m).from(f).to(this.iframe).andTo(this.blurStylesHost);r.copyStyles(o).from(f).to(this.element).andTo(this.blurStylesHost);r.insertCSS(n).into(this.element.ownerDocument);j(f);r.copyStyles(m).from(f).to(this.focusStylesHost);r.copyStyles(o).from(f).to(this.focusStylesHost);var a=s.lang.array(m).without(["display"]);d?d.focus():f.blur();e&&f.setAttribute("placeholder",c);s.browser.hasCurrentStyleProperty()||r.observe(q,"resize",function(){var g=r.getStyle("display").from(f);f.style.display="";r.copyStyles(l).from(f).to(b.iframe).andTo(b.focusStylesHost).andTo(b.blurStylesHost);f.style.display=g});this.parent.observe("focus:composer",function(){r.copyStyles(a).from(b.focusStylesHost).to(b.iframe);r.copyStyles(o).from(b.focusStylesHost).to(b.element)});this.parent.observe("blur:composer",function(){r.copyStyles(a).from(b.blurStylesHost).to(b.iframe);r.copyStyles(o).from(b.blurStylesHost).to(b.element)});return this}})(wysihtml5);(function(e){var h=e.dom,f=e.browser,g={66:"bold",73:"italic",85:"underline"};e.views.Composer.prototype.observe=function(){var o=this,n=this.getValue(),d=this.sandbox.getIframe(),c=this.element,l=f.supportsEventsInIframeCorrectly()?c:this.sandbox.getWindow(),a=f.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];h.observe(d,"DOMNodeRemoved",function(){clearInterval(b);o.parent.fire("destroy:composer")});var b=setInterval(function(){h.contains(document.documentElement,d)||(clearInterval(b),o.parent.fire("destroy:composer"))},250);h.observe(l,"focus",function(){o.parent.fire("focus").fire("focus:composer");setTimeout(function(){n=o.getValue()},0)});h.observe(l,"blur",function(){n!==o.getValue()&&o.parent.fire("change").fire("change:composer");o.parent.fire("blur").fire("blur:composer")});e.browser.isIos()&&h.observe(c,"blur",function(){var j=c.ownerDocument.createElement("input"),i=document.documentElement.scrollTop||document.body.scrollTop,p=document.documentElement.scrollLeft||document.body.scrollLeft;try{o.selection.insertNode(j)}catch(k){c.appendChild(j)}j.focus();j.parentNode.removeChild(j);window.scrollTo(p,i)});h.observe(c,"dragenter",function(){o.parent.fire("unset_placeholder")});f.firesOnDropOnlyWhenOnDragOverIsCancelled()&&h.observe(c,["dragover","dragenter"],function(i){i.preventDefault()});h.observe(c,a,function(i){var k=i.dataTransfer,j;k&&f.supportsDataTransfer()&&(j=k.getData("text/html")||k.getData("text/plain"));j?(c.focus(),o.commands.exec("insertHTML",j),o.parent.fire("paste").fire("paste:composer"),i.stopPropagation(),i.preventDefault()):setTimeout(function(){o.parent.fire("paste").fire("paste:composer")},0)});h.observe(c,"keyup",function(i){i=i.keyCode;(i===e.SPACE_KEY||i===e.ENTER_KEY)&&o.parent.fire("newword:composer")});this.parent.observe("paste:composer",function(){setTimeout(function(){o.parent.fire("newword:composer")},0)});f.canSelectImagesInContentEditable()||h.observe(c,"mousedown",function(j){var i=j.target;"IMG"===i.nodeName&&(o.selection.selectNode(i),j.preventDefault())});h.observe(c,"keydown",function(j){var i=g[j.keyCode];if((j.ctrlKey||j.metaKey)&&i){o.commands.exec(i),j.preventDefault()}});h.observe(c,"keydown",function(i){var k=o.selection.getSelectedNode(!0),j=i.keyCode;if(k&&"IMG"===k.nodeName&&(j===e.BACKSPACE_KEY||j===e.DELETE_KEY)){j=k.parentNode,j.removeChild(k),"A"===j.nodeName&&!j.firstChild&&j.parentNode.removeChild(j),setTimeout(function(){e.quirks.redraw(c)},0),i.preventDefault()}});var m={IMG:"Image: ",A:"Link: "};h.observe(c,"mouseover",function(j){var j=j.target,i=j.nodeName;"A"!==i&&"IMG"!==i||(i=m[i]+(j.getAttribute("href")||j.getAttribute("src")),j.setAttribute("title",i))})}})(wysihtml5);(function(a){a.views.Synchronizer=Base.extend({constructor:function(c,e,f){this.editor=c;this.textarea=e;this.composer=f;this._observe()},fromComposerToTextarea:function(b){this.textarea.setValue(a.lang.string(this.composer.getValue()).trim(),b)},fromTextareaToComposer:function(c){var d=this.textarea.getValue();d?this.composer.setValue(d,c):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(c){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(c):this.fromComposerToTextarea(c)},_observe:function(){var j,b=this,i=this.textarea.element.form,h=function(){j=setInterval(function(){b.fromComposerToTextarea()},400)},g=function(){clearInterval(j);j=null};h();i&&(a.dom.observe(i,"submit",function(){b.sync(!0)}),a.dom.observe(i,"reset",function(){setTimeout(function(){b.fromTextareaToComposer()},0)}));this.editor.observe("change_view",function(c){if(c==="composer"&&!j){b.fromTextareaToComposer(true);h()}else{if(c==="textarea"){b.fromComposerToTextarea(true);g()}}});this.editor.observe("destroy:composer",g)}})})(wysihtml5);wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(d,f,e){this.base(d,f,e);this._observe()},clear:function(){this.element.value=""},getValue:function(a){var d=this.isEmpty()?"":this.element.value;a&&(d=this.parent.parse(d));return d},setValue:function(a,d){d&&(a=this.parent.parse(a));this.element.value=a},hasPlaceholderSet:function(){var d=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),f=this.element.getAttribute("placeholder")||null,e=this.element.value;return d&&!e||e===f},isEmpty:function(){return !wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,h=this.parent,f={focusin:"focus",focusout:"blur"},g=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];h.observe("beforeload",function(){wysihtml5.dom.observe(e,g,function(a){a=f[a.type]||a.type;h.fire(a).fire(a+":textarea")});wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){h.fire("paste").fire("paste:textarea")},0)})})}});(function(a){var d=a.dom;a.toolbar.Dialog=a.lang.Dispatcher.extend({constructor:function(e,c){this.link=e;this.container=c},_observe:function(){if(!this._observed){var b=this,l=function(e){var f=b._serialize();f==b.elementToChange?b.fire("edit",f):b.fire("save",f);b.hide();e.preventDefault();e.stopPropagation()};d.observe(b.link,"click",function(){d.hasClass(b.link,"wysihtml5-command-dialog-opened")&&setTimeout(function(){b.hide()},0)});d.observe(this.container,"keydown",function(h){var f=h.keyCode;f===a.ENTER_KEY&&l(h);f===a.ESCAPE_KEY&&b.hide()});d.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",l);d.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){b.fire("cancel");b.hide();e.preventDefault();e.stopPropagation()});for(var k=this.container.querySelectorAll("input, select, textarea"),j=0,g=k.length,c=function(){clearInterval(b.interval)};j<g;j++){d.observe(k[j],"change",c)}this._observed=!0}},_serialize:function(){for(var g=this.elementToChange||{},e=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),i=e.length,h=0;h<i;h++){g[e[h].getAttribute("data-wysihtml5-dialog-field")]=e[h].value}return g},_interpolate:function(j){for(var e,o,n=document.querySelector(":focus"),l=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),k=l.length,m=0;m<k;m++){e=l[m],e!==n&&!(j&&"hidden"===e.type)&&(o=e.getAttribute("data-wysihtml5-dialog-field"),o=this.elementToChange?this.elementToChange[o]||"":e.defaultValue,e.value=o)}},show:function(g){var c=this,i=this.container.querySelector("input, select, textarea");this.elementToChange=g;this._observe();this._interpolate();g&&(this.interval=setInterval(function(){c._interpolate(!0)},500));d.addClass(this.link,"wysihtml5-command-dialog-opened");this.container.style.display="";this.fire("show");if(i&&!g){try{i.focus()}catch(h){}}},hide:function(){clearInterval(this.interval);this.elementToChange=null;d.removeClass(this.link,"wysihtml5-command-dialog-opened");this.container.style.display="none";this.fire("hide")}})})(wysihtml5);(function(g){var l=g.dom,h={position:"relative"},k={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},j={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},i={"x-webkit-speech":"",speech:""};g.toolbar.Speech=function(c,b){var d=document.createElement("input");if(g.browser.supportsSpeechApiOn(d)){var a=document.createElement("div");g.lang.object(k).merge({width:b.offsetWidth+"px",height:b.offsetHeight+"px"});l.insert(d).into(a);l.insert(a).into(b);l.setStyles(j).on(d);l.setAttributes(i).on(d);l.setStyles(k).on(a);l.setStyles(h).on(b);l.observe(d,"onwebkitspeechchange" in d?"webkitspeechchange":"speechchange",function(){c.execCommand("insertText",d.value);d.value=""});l.observe(d,"click",function(e){l.hasClass(b,"wysihtml5-command-disabled")&&e.preventDefault();e.stopPropagation()})}else{b.style.display="none"}}})(wysihtml5);(function(a){var d=a.dom;a.toolbar.Toolbar=Base.extend({constructor:function(b,k){this.editor=b;this.container="string"===typeof k?document.getElementById(k):k;this.composer=b.composer;this._getLinks("command");this._getLinks("action");this._observe();this.show();for(var j=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),i=j.length,g=0;g<i;g++){new a.toolbar.Speech(this,j[g])}},_getLinks:function(s){for(var r=this[s+"Links"]=a.lang.array(this.container.querySelectorAll("a[data-wysihtml5-"+s+"]")).get(),q=r.length,p=0,n=this[s+"Mapping"]={},m,o,b,l;p<q;p++){m=r[p],o=m.getAttribute("data-wysihtml5-"+s),b=m.getAttribute("data-wysihtml5-"+s+"-value"),l=this._getDialog(m,o),n[o+":"+b]={link:m,name:o,value:b,dialog:l,state:!1}}},_getDialog:function(b,m){var l=this,k=this.container.querySelector("[data-wysihtml5-dialog='"+m+"']"),j,g;k&&(j=new a.toolbar.Dialog(b,k),j.observe("show",function(){g=l.composer.selection.getBookmark();l.editor.fire("show:dialog",{command:m,dialogContainer:k,commandLink:b})}),j.observe("save",function(c){g&&l.composer.selection.setBookmark(g);l._execCommand(m,c);l.editor.fire("save:dialog",{command:m,dialogContainer:k,commandLink:b})}),j.observe("cancel",function(){l.editor.focus(!1);l.editor.fire("cancel:dialog",{command:m,dialogContainer:k,commandLink:b})}));return j},execCommand:function(f,e){if(!this.commandsDisabled){var g=this.commandMapping[f+":"+e];g&&g.dialog&&!g.state?g.dialog.show():this._execCommand(f,e)}},_execCommand:function(e,c){this.editor.focus(!1);this.composer.commands.exec(e,c);this._updateLinkStates()},execAction:function(e){var c=this.editor;switch(e){case"change_view":c.currentView===c.textarea?c.fire("change_view","composer"):c.fire("change_view","textarea")}},_observe:function(){for(var g=this,c=this.editor,m=this.container,l=this.commandLinks.concat(this.actionLinks),k=l.length,j=0;j<k;j++){d.setAttributes({href:"javascript:;",unselectable:"on"}).on(l[j])}d.delegate(m,"[data-wysihtml5-command]","mousedown",function(b){b.preventDefault()});d.delegate(m,"[data-wysihtml5-command]","click",function(e){var h=this.getAttribute("data-wysihtml5-command"),f=this.getAttribute("data-wysihtml5-command-value");g.execCommand(h,f);e.preventDefault()});d.delegate(m,"[data-wysihtml5-action]","click",function(e){var f=this.getAttribute("data-wysihtml5-action");g.execAction(f);e.preventDefault()});c.observe("focus:composer",function(){g.bookmark=null;clearInterval(g.interval);g.interval=setInterval(function(){g._updateLinkStates()},500)});c.observe("blur:composer",function(){clearInterval(g.interval)});c.observe("destroy:composer",function(){clearInterval(g.interval)});c.observe("change_view",function(e){setTimeout(function(){g.commandsDisabled="composer"!==e;g._updateLinkStates();g.commandsDisabled?d.addClass(m,"wysihtml5-commands-disabled"):d.removeClass(m,"wysihtml5-commands-disabled")},0)})},_updateLinkStates:function(){var b=this.commandMapping,h,g,c;for(h in b){if(c=b[h],this.commandsDisabled?(g=!1,d.removeClass(c.link,"wysihtml5-command-active"),c.dialog&&c.dialog.hide()):(g=this.composer.commands.state(c.name,c.value),a.lang.object(g).isArray()&&(g=1===g.length?g[0]:!0),d.removeClass(c.link,"wysihtml5-command-disabled")),c.state!==g){(c.state=g)?(d.addClass(c.link,"wysihtml5-command-active"),c.dialog&&("object"===typeof g?c.dialog.show(g):c.dialog.hide())):(d.removeClass(c.link,"wysihtml5-command-active"),c.dialog&&c.dialog.hide())}}},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})})(wysihtml5);(function(a){var d={name:void 0,style:!0,toolbar:void 0,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:a.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:void 0,allowObjectResizing:!0,supportTouchDevices:!0};a.Editor=a.lang.Dispatcher.extend({constructor:function(b,h){this.textareaElement="string"===typeof b?document.getElementById(b):b;this.config=a.lang.object({}).merge(d).merge(h).get();this.currentView=this.textarea=new a.views.Textarea(this,this.textareaElement,this.config);this._isCompatible=a.browser.supported();if(!this._isCompatible||!this.config.supportTouchDevices&&a.browser.isTouchDevice()){var g=this;setTimeout(function(){g.fire("beforeload").fire("load")},0)}else{a.dom.addClass(document.body,this.config.bodyClassName);this.currentView=this.composer=new a.views.Composer(this,this.textareaElement,this.config);"function"===typeof this.config.parser&&this._initParser();this.observe("beforeload",function(){this.synchronizer=new a.views.Synchronizer(this,this.textarea,this.composer);this.config.toolbar&&(this.toolbar=new a.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(c){}}},isCompatible:function(){return this._isCompatible},clear:function(){this.currentView.clear();return this},getValue:function(b){return this.currentView.getValue(b)},setValue:function(e,c){if(!e){return this.clear()}this.currentView.setValue(e,c);return this},focus:function(b){this.currentView.focus(b);return this},disable:function(){this.currentView.disable();return this},enable:function(){this.currentView.enable();return this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(b){var e=this.config.parser(b,this.config.parserRules,this.composer.sandbox.getDocument(),!0);"object"===typeof b&&a.quirks.redraw(b);return e},_initParser:function(){this.observe("paste:composer",function(){var b=this;b.composer.selection.executeAndRestore(function(){a.quirks.cleanPastedHTML(b.composer.element);b.parse(b.composer.element)},!0)});this.observe("paste:textarea",function(){this.textarea.setValue(this.parse(this.textarea.getValue()))})}})})(wysihtml5);