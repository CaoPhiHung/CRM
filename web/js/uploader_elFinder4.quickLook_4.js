(function(a){elFinder.prototype.quickLook=function(k,b){var o=this;this.fm=k;this._hash="";this.title=a("<strong/>");this.ico=a("<p/>");this.info=a("<label/>");this.media=a('<div class="el-finder-ql-media"/>').hide();this.name=a('<span class="el-finder-ql-name"/>');this.kind=a('<span class="el-finder-ql-kind"/>');this.size=a('<span class="el-finder-ql-size"/>');this.date=a('<span class="el-finder-ql-date"/>');this.url=a('<a href="#"/>').hide().click(function(i){i.preventDefault();window.open(a(this).attr("href"));o.hide()});this.add=a("<div/>");this.content=a('<div class="el-finder-ql-content"/>');this.win=a('<div class="el-finder-ql"/>').hide().append(a('<div class="el-finder-ql-drag-handle"/>').append(a('<span class="ui-icon ui-icon-circle-close"/>').click(function(){o.hide()})).append(this.title)).append(this.ico).append(this.media).append(this.content.append(this.name).append(this.kind).append(this.size).append(this.date).append(this.url).append(this.add)).appendTo("body").draggable({handle:".el-finder-ql-drag-handle"}).resizable({minWidth:420,minHeight:150,resize:function(){if(o.media.children().length){var m=o.media.children(":first");switch(m[0].nodeName){case"IMG":var e=m.width(),n=m.height(),i=o.win.width(),q=o.win.css("height")=="auto"?350:o.win.height()-o.content.height()-o.th,p=e>i||n>q?Math.min(Math.min(i,e)/e,Math.min(q,n)/n):Math.min(Math.max(i,e)/e,Math.max(q,n)/n);m.css({width:Math.round(m.width()*p),height:Math.round(m.height()*p)});break;case"IFRAME":case"EMBED":m.css("height",o.win.height()-o.content.height()-o.th);break;case"OBJECT":m.children("embed").css("height",o.win.height()-o.content.height()-o.th)}}}});this.th=parseInt(this.win.children(":first").css("height"))||18;this.mimes={"image/jpeg":"jpg","image/gif":"gif","image/png":"png"};for(var g=0;g<navigator.mimeTypes.length;g++){var l=navigator.mimeTypes[g].type;if(l&&l!="*"){this.mimes[l]=navigator.mimeTypes[g].suffixes}}if((a.browser.safari&&navigator.platform.indexOf("Mac")!=-1)||a.browser.msie){this.mimes["application/pdf"]="pdf"}else{for(var c=0;c<navigator.plugins.length;c++){for(var d=0;d<navigator.plugins[c].length;d++){var j=navigator.plugins[c][d].description.toLowerCase();if(j.substring(0,j.indexOf(" "))=="pdf"){this.mimes["application/pdf"]="pdf";break}}}}if(this.mimes["image/x-bmp"]){this.mimes["image/x-ms-bmp"]="bmp"}if(a.browser.msie&&!this.mimes["application/x-shockwave-flash"]){this.mimes["application/x-shockwave-flash"]="swf"}this.show=function(){if(this.win.is(":hidden")&&o.fm.selected.length==1){f();var m=o.fm.selected[0],e=o.fm.view.cwd.find('[key="'+m+'"]'),i=e.offset();o.fm.lockShortcuts(true);this.win.css({width:e.width()-20,height:e.height(),left:i.left,top:i.top,opacity:0}).show().animate({width:420,height:150,opacity:1,top:Math.round(a(window).height()/5),left:a(window).width()/2-210},450,function(){o.win.css({height:"auto"});o.fm.lockShortcuts()})}};this.hide=function(){if(this.win.is(":visible")){var i,e=o.fm.view.cwd.find('[key="'+this._hash+'"]');if(e){i=e.offset();this.media.hide(200);this.win.animate({width:e.width()-20,height:e.height(),left:i.left,top:i.top,opacity:0},350,function(){o.fm.lockShortcuts();h();o.win.hide().css("height","auto")})}else{this.win.fadeOut(200);h();o.fm.lockShortcuts()}}};this.toggle=function(){if(this.win.is(":visible")){this.hide()}else{this.show()}};this.update=function(){if(this.fm.selected.length!=1){this.hide()}else{if(this.win.is(":visible")&&this.fm.selected[0]!=this._hash){f()}}};this.mediaHeight=function(){return this.win.is(":animated")||this.win.css("height")=="auto"?315:this.win.height()-this.content.height()-this.th};function h(){o.media.hide().empty();o.win.attr("class","el-finder-ql").css("z-index",o.fm.zIndex);o.title.empty();o.ico.attr("style","").show();o.add.hide().empty();o._hash=""}function f(){var m=o.fm.getSelected(0);h();o._hash=m.hash;o.title.text(m.name);o.win.addClass(o.fm.view.mime2class(m.mime));o.name.text(m.name);o.kind.text(o.fm.view.mime2kind(m.link?"symlink":m.mime));o.size.text(o.fm.view.formatSize(m.size));o.date.text(o.fm.i18n("Modified")+": "+o.fm.view.formatDate(m.date));m.dim&&o.add.append("<span>"+m.dim+" px</span>").show();m.tmb&&o.ico.css("background",'url("'+m.tmb+'") 0 0 no-repeat');if(m.url){o.url.text(m.url).attr("href",m.url).show();for(var e in o.plugins){if(o.plugins[e].test&&o.plugins[e].test(m.mime,o.mimes,m.name)){o.plugins[e].show(o,m);return}}}else{o.url.hide()}o.win.css({width:"420px",height:"auto"})}};elFinder.prototype.quickLook.prototype.plugins={image:new function(){this.test=function(c,b){return c.match(/^image\//)};this.show=function(e,d){var b,c;if(e.mimes[d.mime]&&d.hash==e._hash){a("<img/>").hide().appendTo(e.media.show()).attr("src",d.url+(a.browser.msie||a.browser.opera?"?"+Math.random():"")).load(function(){c=a(this).unbind("load");if(d.hash==e._hash){e.win.is(":animated")?setTimeout(function(){g(c)},330):g(c)}})}function g(j){var i=j.width(),l=j.height(),f=e.win.is(":animated"),k=f?420:e.win.width(),n=f||e.win.css("height")=="auto"?315:e.win.height()-e.content.height()-e.th,m=i>k||l>n?Math.min(Math.min(k,i)/i,Math.min(n,l)/l):Math.min(Math.max(k,i)/i,Math.max(n,l)/l);e.fm.lockShortcuts(true);e.ico.hide();j.css({width:e.ico.width(),height:e.ico.height()}).show().animate({width:Math.round(m*i),height:Math.round(m*l)},450,function(){e.fm.lockShortcuts()})}}},text:new function(){this.test=function(c,b){return(c.indexOf("text")==0&&c.indexOf("rtf")==-1)||c.match(/application\/(xml|javascript|json)/)};this.show=function(c,b){if(b.hash==c._hash){c.ico.hide();c.media.append('<iframe src="'+b.url+'" style="height:'+c.mediaHeight()+'px" />').show()}}},swf:new function(){this.test=function(c,b){return c=="application/x-shockwave-flash"&&b[c]};this.show=function(c,b){if(b.hash==c._hash){c.ico.hide();var d=c.media.append('<embed pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="'+b.url+'" style="width:100%;height:'+c.mediaHeight()+'px" type="application/x-shockwave-flash" />');if(c.win.is(":animated")){d.slideDown(450)}else{d.show()}}}},audio:new function(){this.test=function(c,b){return c.indexOf("audio")==0&&b[c]};this.show=function(d,c){if(c.hash==d._hash){d.ico.hide();var b=d.win.is(":animated")||d.win.css("height")=="auto"?100:d.win.height()-d.content.height()-d.th;d.media.append('<embed src="'+c.url+'" style="width:100%;height:'+b+'px" />').show()}}},video:new function(){this.test=function(c,b){return c.indexOf("video")==0&&b[c]};this.show=function(c,b){if(b.hash==c._hash){c.ico.hide();c.media.append('<embed src="'+b.url+'" style="width:100%;height:'+c.mediaHeight()+'px" />').show()}}},pdf:new function(){this.test=function(c,b){return c=="application/pdf"&&b[c]};this.show=function(c,b){if(b.hash==c._hash){c.ico.hide();c.media.append('<embed src="'+b.url+'" style="width:100%;height:'+c.mediaHeight()+'px" />').show()}}}}})(jQuery);